<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Cn">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="前端技术文章，JavaScript设计模式，专注前端10年。">
<meta property="og:type" content="website">
<meta property="og:title" content="小小坤">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="小小坤">
<meta property="og:description" content="前端技术文章，JavaScript设计模式，专注前端10年。">
<meta property="og:locale" content="zh-Cn">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="小小坤">
<meta name="twitter:description" content="前端技术文章，JavaScript设计模式，专注前端10年。">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/">





  <title>小小坤</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Cn">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">小小坤</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">是你改变了世界还是世界被你改变</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-首页">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-关于我">
          <a href="/2018/08/16/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-calendar"></i> <br>
            
            关于我
          </a>
        </li>
      
        
        <li class="menu-item menu-item-归档">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/14/【闲谈】如何统计字符串中出现最多的字母与个数-1/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小小坤">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/log.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小小坤">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/14/【闲谈】如何统计字符串中出现最多的字母与个数-1/" itemprop="url">【闲谈】如何统计字符串中出现最多的字母与个数</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-12-14T17:55:28+08:00">
                2018-12-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>闲来无事，穷折腾。最近我朋友在找工作，遇到一些面试题，或者遇到一些问题会及时跟我讨论。我则作为他的幕后军师，为他出谋划策。接下来我分享给大家一道简单的面试题。</p>
<h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><blockquote>
<p><strong>统计字符串中出现最多的字母与个数？</strong></p>
</blockquote>
<h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1、验证数据是否字符串</span><br><span class="line">2、字符串转换为数组</span><br><span class="line">3、统计字符串出现的次数</span><br></pre></td></tr></table></figure>
<p>例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var str = &apos;aaaadddddssssgdhssssbbbbbuuuwmopqlsabcfwsqdghgukssuyutsudddddsasss&apos;;</span><br></pre></td></tr></table></figure></p>
<p>写一个函数专门处理这个事情。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">* </span><br><span class="line">* 检查字符串中出现次数最多的那个</span><br><span class="line">* </span><br><span class="line">*/</span><br><span class="line">function maximum(s) &#123;</span><br><span class="line">    //【第一步】验证合法性</span><br><span class="line">   if (typeof s !== &apos;string&apos;) &#123;</span><br><span class="line">       throw (&apos;s is string&apos;);</span><br><span class="line">    &#125;</span><br><span class="line">    //【第二步】转换为数组</span><br><span class="line">    var array = s.split(&quot;&quot;);</span><br><span class="line">    //【第三步】找出最多的字母</span><br><span class="line">    //这一步最关键</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其实最重要的是第三步，看你站在什么样的思路去找对应的字母与其个数。大多数人会选择使用两个循环进行处理。</p>
<p>代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 检查字符串中出现次数最多的那个</span><br><span class="line"> */</span><br><span class="line">function maximum(s) &#123;</span><br><span class="line">  if (typeof s !== &quot;string&quot;) &#123;</span><br><span class="line">    throw &quot;s is string&quot;;</span><br><span class="line">  &#125;</span><br><span class="line">  var array = s.split(&quot;&quot;),</span><br><span class="line">    l = array.length,</span><br><span class="line">    obj = &#123;&#125;,</span><br><span class="line">    ismaxObj = &#123;</span><br><span class="line">      max: 0,</span><br><span class="line">      val: &quot;&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    arrayVal = &quot;&quot;;</span><br><span class="line">  while (l--) &#123;</span><br><span class="line">    arrayVal = array[l];</span><br><span class="line">    if (!obj[arrayVal]) &#123;</span><br><span class="line">      obj[arrayVal] = [];</span><br><span class="line">    &#125;</span><br><span class="line">    obj[arrayVal].push(arrayVal);</span><br><span class="line">    if (ismaxObj.max != 0) &#123;</span><br><span class="line">      if (obj[arrayVal].length &gt; ismaxObj.max) &#123;</span><br><span class="line">        ismaxObj.max = obj[arrayVal].length;</span><br><span class="line">        ismaxObj.val = array[l];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      ismaxObj.max = obj[arrayVal].length;</span><br><span class="line">      ismaxObj.val = arrayVal;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  //console.log(array);</span><br><span class="line">  console.log(ismaxObj);//出现次数最多的字母与次数</span><br><span class="line">  console.log(obj);//数据重组直观看到数据分布</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">maximum(</span><br><span class="line">  &quot;aaaadddddsgdhssssbbbbbuuupqlsabcfwsqdghgukssuyutsudddddsasss，ewfd,null,undefind.?Qzadsdvsf\/\\\\[;ll;,lw&quot;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>结果如图所示：</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/12/14/167ac062ee99ba57?w=1035&amp;h=627&amp;f=jpeg&amp;s=40225" alt=""></p>
<h2 id="追问"><a href="#追问" class="headerlink" title="追问"></a>追问</h2><p>如果面试官追问，如何确定最多的字母的第一个位置与最后一个位置？<br>其实我们在push的时候就可以把这个数据的位置存起来，稍加改动即可求出。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 检查字符串中出现次数最多的那个</span><br><span class="line"> */</span><br><span class="line">function maximum(s) &#123;</span><br><span class="line">  if (typeof s !== &quot;string&quot;) &#123;</span><br><span class="line">    throw &quot;s is string&quot;;</span><br><span class="line">  &#125;</span><br><span class="line">  var array = s.split(&quot;&quot;),</span><br><span class="line">    ll = array.length,</span><br><span class="line">    obj = &#123;&#125;,</span><br><span class="line">    ismaxObj = &#123;</span><br><span class="line">      max: 0,</span><br><span class="line">      val: &quot;&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    arrayVal = &quot;&quot;;</span><br><span class="line">  for (var l=0;l&lt;ll;l++) &#123;</span><br><span class="line">    arrayVal = array[l];</span><br><span class="line">    if (!obj[arrayVal]) &#123;</span><br><span class="line">      obj[arrayVal] = [];</span><br><span class="line">    &#125;</span><br><span class="line">    obj[arrayVal].push(arrayVal+&apos;-&apos;+l);</span><br><span class="line">    if (ismaxObj.max != 0) &#123;</span><br><span class="line">      if (obj[arrayVal].length &gt; ismaxObj.max) &#123;</span><br><span class="line">        ismaxObj.max = obj[arrayVal].length;</span><br><span class="line">        ismaxObj.val = array[l];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      ismaxObj.max = obj[arrayVal].length;</span><br><span class="line">      ismaxObj.val = arrayVal;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  console.log(obj[ismaxObj.val][0],obj[ismaxObj.val][obj[ismaxObj.val].length-1]);//最多的字母的第一个位置与最后一个位置</span><br><span class="line">  console.log(ismaxObj);//出现次数最多的字母与次数</span><br><span class="line">  console.log(obj);//数据重组直观看到数据分布</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://user-gold-cdn.xitu.io/2018/12/14/167ac1277faacee8?w=1256&amp;h=733&amp;f=jpeg&amp;s=71581" alt=""><br>这是我给出的方案，也许还不是最优质的。望各位大佬指正。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>其实对于面试来说最重要的是考察面试者处理问题的逻辑思路，有些人能够解决问题，有些人能够以最优质的方案解决问题。前者是干活的人，后者是干好活的人。</p>
<p>代码是一种神奇的东西，我们可以驱动它干好多事情。为什么我们不好好做一个控制者呢！！<br>打赏通道–我觉得不会有打赏。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/11/28/167592f13078d6a8?w=800&amp;h=600&amp;f=jpeg&amp;s=184358" alt=""></p>
<p><img src="https://user-gold-cdn.xitu.io/2018/4/14/162c4b13a41e4a3a?w=323&amp;h=311&amp;f=png&amp;s=83969" alt=""></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/16/first/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小小坤">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/log.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小小坤">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/16/first/" itemprop="url">高阶函数实现AOP</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-11-16T16:30:00+08:00">
                2018-11-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>  AOP（面向切面程序）的主要作用是把一些跟核心业务逻辑模块无关的功能抽离出来，这些跟业务逻辑无关的功能通常包括日至统计、安全控制、异常处理等。把这些功能抽离出来之后，再通过“动态织入”的方式掺入业务逻辑模块中。这样做的好处首先是可以保证业务逻辑模块的纯洁和高内聚性，其次是可以很方便的复用日志统计模块。在JavaScript中实现AOP，都是只把一个函数“动态织入”到另一个函数之中，具体实现技术很多，现在来实现一个。</p>
<h2 id="面向切面程序"><a href="#面向切面程序" class="headerlink" title="面向切面程序"></a>面向切面程序</h2>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">  Function.prototype.before=function(beforefn)&#123;</span><br><span class="line">    var self=this;//保存原函数的引用</span><br><span class="line">    return function()&#123;//返回包含了原函数和新函数的“代理”函数</span><br><span class="line">        beforefn.apply(this,arguments);//执行新函数，修正this</span><br><span class="line">        return self.apply(this,arguments);//执行原函数</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">Function.prototype.after=function(afterfn)&#123;</span><br><span class="line">    var self=this;//保存原函数的引用</span><br><span class="line">    return function()&#123;//返回包含了原函数和新函数的“代理”函数</span><br><span class="line">        var ret=self.apply(this,arguments);//执行原函数</span><br><span class="line">        afterfn.apply(this,arguments);//执行新函数，修正this</span><br><span class="line">        return ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var fn=function()&#123;</span><br><span class="line">    console.log(&quot;fn&quot;);</span><br><span class="line">&#125;</span><br><span class="line">fn=fn.before(function()&#123;</span><br><span class="line">    console.log(&quot;before&quot;);</span><br><span class="line">&#125;).after(function()&#123;</span><br><span class="line">    console.log(&quot;after&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">fn();</span><br></pre></td></tr></table></figure>
<h2 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h2><p>  AOP（面向切面程序）使用的场景还是很多的，那最简单例子来说，现在小明入职刚刚入职，之前他们写的代码小明还没时间看，现在呢！要小明实现一个form表单提交前验证。小明看了看之前的验证规则，是一个很大的函数，内部代码混乱不堪，无从下手，甚至不知道修改了会不会影响其他功能。现在AOP（面向切面程序）就给我们提供了方便。下面我给大家演示一下怎么使用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Function.prototype.before=function(beforefn)&#123;</span><br><span class="line">    var self=this;//保存原函数的引用</span><br><span class="line">    return function()&#123;//返回包含了原函数和新函数的“代理”函数</span><br><span class="line">        if(beforefn.apply(this,arguments))&#123;</span><br><span class="line">            return self.apply(this,arguments);//执行原函数</span><br><span class="line">        &#125;;//执行新函数，修正this</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var fn=function()&#123;</span><br><span class="line">    console.log(&quot;form表单提交&quot;);</span><br><span class="line">&#125;</span><br><span class="line">fn=fn.before(function()&#123;</span><br><span class="line">    if(1==1)&#123;</span><br><span class="line">        console.log(&quot;验证通过&quot;);</span><br><span class="line">        return true;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        console.log(&quot;验证失败&quot;);</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fn();</span><br></pre></td></tr></table></figure>
<p>可以看出，我们不需要知道你这个函数内容是什么。我们只关心我们写的代码，用户提交的数据是否正确。</p>
<h2 id="简单方式实现AOP（面向切面程序）"><a href="#简单方式实现AOP（面向切面程序）" class="headerlink" title="简单方式实现AOP（面向切面程序）"></a>简单方式实现AOP（面向切面程序）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function ajax()&#123;</span><br><span class="line">     console.log(&quot;fajax提交&quot;);</span><br><span class="line">&#125;</span><br><span class="line">var ajaxfn=ajax;//把ajax函数引用保存起来。</span><br><span class="line">var ajax=function ()&#123;//重新ajax函数；</span><br><span class="line">    if(1==1)&#123;</span><br><span class="line">        console.log(&quot;验证通过&quot;);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">    //先验证上边代码在执行ajax提交</span><br><span class="line">    ajaxfn();</span><br><span class="line">&#125;</span><br><span class="line">ajax();</span><br></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>AOP（面向切面程序）在实际应用中还是很广泛。希望上边的方法能够帮助你写出更为简洁的代码处理复杂的业务。如果有不对的地方希望大家指出。</p>
<p>代码是一种神奇的东西，我们可以驱动它干好多事情。为什么我们不好好做一个控制者呢！！<br>打赏通道–我觉得不会有打赏。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/11/28/167592f13078d6a8?w=800&amp;h=600&amp;f=jpeg&amp;s=184358" alt=""></p>
<p><img src="https://user-gold-cdn.xitu.io/2018/4/14/162c4b13a41e4a3a?w=323&amp;h=311&amp;f=png&amp;s=83969" alt=""></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/16/dingyue/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小小坤">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/log.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小小坤">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/16/dingyue/" itemprop="url">发布订阅</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-10-16T16:30:00+08:00">
                2018-10-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>  发布-订阅模式又叫观察者模式,它定义对象间的一种一对多的依赖关系,当一个对象的状态发生改变时,所有依赖于它的对象都将得到通知。JavaScript开发中我们一般用事件模型来代替传统的发布-订阅模式</p>
<h2 id="案例介绍1"><a href="#案例介绍1" class="headerlink" title="案例介绍1"></a>案例介绍1</h2><p>小明最近喜欢上吃老北京烧饼,可是到了卖烧饼的地方发现已经卖完了,而且排队的人还很多.幸运的是卖烧饼那个MM看小明长得帅,告诉小明等一会就有烧饼吃啦!可是小明现在还有约会要去,不知道烧饼能什么时候出锅,总不能因为吃烧饼而不去约会吧!这时候小明灵机一动,说烧饼MM把你电话给我吧!我先去忙,等会打电话问你烧饼好了没有。烧饼MM也没想太多,把电话给小明了。后来小龙也来买烧饼，情况跟小明差不多,小龙也把烧饼MM的电话要走了。可是问题就这来了,小明、小龙一会儿打一个电话给烧饼MM,导致烧饼MM很烦,辞职走了不干了。<br>通过上边的事情我们可以发现,存在好多问题<br>   第一:卖烧饼的MM应该充当发布者<br>   第二:小明小龙的电话应该保存在卖烧饼的用户列表中,如果卖烧饼的MM离职,这用户就会丢失<br>   第三:实际上没有这么笨蛋的销售方式的</p>
<p>卖烧饼的店主可以把小明、小龙的电话记录下来,等店里有烧饼了在通知小龙小明来拿这就是所谓的发布-订阅模式，代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">/*烧饼店*/        </span><br><span class="line">var Sesamecakeshop=&#123;</span><br><span class="line">    clienlist:[],//缓存列表</span><br><span class="line">    addlisten:function(fn)&#123;//增加订阅者</span><br><span class="line">        this.clienlist.push(fn);</span><br><span class="line">    &#125;,</span><br><span class="line">    trigger:function()&#123;//发布消息</span><br><span class="line">        for(var i=0,fn;fn=this.clienlist[i++];)&#123;</span><br><span class="line">            fn.apply(this,arguments);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/*小明发布订阅*/</span><br><span class="line">Sesamecakeshop.addlisten(function(price,taste)&#123;</span><br><span class="line">    console.log(&quot;小明发布的&quot;+price+&quot;元，&quot;+taste+&quot;味道的&quot;);</span><br><span class="line">&#125;);</span><br><span class="line">/*小龙发布订阅*/</span><br><span class="line">Sesamecakeshop.addlisten(function(price,taste)&#123;</span><br><span class="line">    console.log(&quot;小龙发布的&quot;+price+&quot;元，&quot;+taste+&quot;味道的&quot;);</span><br><span class="line">&#125;);        </span><br><span class="line"></span><br><span class="line">Sesamecakeshop.trigger(10,&quot;椒盐&quot;);</span><br></pre></td></tr></table></figure>
<p> 从代码中可以看出，只有小明，小龙预定了烧饼，烧饼店就可以发布消息告诉小龙与小明。但是有个问题不知道大家发现了没有。小明只喜欢椒盐味道的。而小龙只喜欢焦糖味道的。上面的代码就满足不了客户的需求，给客户一种感觉就是，不管我喜欢不喜欢，你都会发给我。如果发布比较多，客户就会感到厌烦，甚至会想删除订阅。下边是对代码进行改良大家可以看看。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">/*烧饼店*/        </span><br><span class="line">var Sesamecakeshop=&#123;</span><br><span class="line">    clienlist:&#123;&#125;,/*缓存列表*/</span><br><span class="line">    /**</span><br><span class="line">     * 增加订阅者</span><br><span class="line">     * @key &#123;String&#125; 类型</span><br><span class="line">     * @fn &#123;Function&#125; 回掉函数</span><br><span class="line">     * */</span><br><span class="line">    addlisten:function(key,fn)&#123;</span><br><span class="line">        if(!this.clienlist[key])&#123;</span><br><span class="line">            this.clienlist[key]=[];</span><br><span class="line">        &#125;</span><br><span class="line">        this.clienlist[key].push(fn);</span><br><span class="line">    &#125;,</span><br><span class="line">    /**</span><br><span class="line">     * 发布消息</span><br><span class="line">     * */</span><br><span class="line">    trigger:function()&#123;</span><br><span class="line">        var key=[].shift.call(arguments),//取出消息类型</span><br><span class="line">            fns=this.clienlist[key];//取出该类型的对应的消息集合</span><br><span class="line">        if(!fns || fns.length===0)&#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        for(var i=0,fn;fn=fns[i++];)&#123;</span><br><span class="line">            fn.apply(this,arguments);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    /**</span><br><span class="line">     * 删除订阅</span><br><span class="line">     * @key &#123;String&#125; 类型</span><br><span class="line">     * @fn &#123;Function&#125; 回掉函数</span><br><span class="line">     * */</span><br><span class="line">    remove:function(key,fn)&#123;</span><br><span class="line">        var fns=this.clienlist[key];//取出该类型的对应的消息集合</span><br><span class="line">        if(!fns)&#123;//如果对应的key没有订阅直接返回</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        if(!fn)&#123;//如果没有传入具体的回掉，则表示需要取消所有订阅</span><br><span class="line">            fns &amp;&amp; (fns.length=0);</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            for(var l=fns.length-1;l&gt;=0;l--)&#123;//遍历回掉函数列表</span><br><span class="line">                if(fn===fns[l])&#123;</span><br><span class="line">                    fns.splice(l,1);//删除订阅者的回掉</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/*小明发布订阅*/</span><br><span class="line">Sesamecakeshop.addlisten(&quot;焦糖&quot;,fn1=function(price,taste)&#123;</span><br><span class="line">    console.log(&quot;小明发布的&quot;+price+&quot;元，&quot;+taste+&quot;味道的&quot;);</span><br><span class="line">&#125;);</span><br><span class="line">/*小龙发布订阅*/</span><br><span class="line">Sesamecakeshop.addlisten(&quot;椒盐&quot;,function(price,taste)&#123;</span><br><span class="line">    console.log(&quot;小龙发布的&quot;+price+&quot;元，&quot;+taste+&quot;味道的&quot;);</span><br><span class="line">&#125;);        </span><br><span class="line"></span><br><span class="line">Sesamecakeshop.trigger(&quot;椒盐&quot;,10,&quot;椒盐&quot;);</span><br><span class="line"></span><br><span class="line">Sesamecakeshop.remove(&quot;焦糖&quot;,fn1);//注意这里是按照地址引用的。如果传入匿名函数则删除不了        </span><br><span class="line">            </span><br><span class="line">Sesamecakeshop.trigger(&quot;焦糖&quot;,40,&quot;焦糖&quot;);</span><br></pre></td></tr></table></figure>
<p> 删除的时候需要注意的是，如果订阅的时候传递的是匿名函数，删除的时候如果传入的也是匿名函数。则删除不了。因为删除时候是按照地址引用删除的。传进去的两个匿名函数，对应的地址引用是不同的。</p>
<h2 id="案例介绍2"><a href="#案例介绍2" class="headerlink" title="案例介绍2"></a>案例介绍2</h2><p> 比如咱们常见的用户身份分别有不同的功能，超级管理员拥有最高权限，可以删除修改任意用户。而普通用户则只能修改自己的账户信息。首先是用户身份验证，验证通过之后对应功能才可以显示。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">//登录发布-订阅模式</span><br><span class="line">login=&#123;</span><br><span class="line">    clienlist:&#123;&#125;,/*缓存列表*/</span><br><span class="line">    /**</span><br><span class="line">     * 增加订阅者</span><br><span class="line">     * @key &#123;String&#125; 类型</span><br><span class="line">     * @fn &#123;Function&#125; 回掉函数</span><br><span class="line">     * */</span><br><span class="line">    addlisten:function(key,fn)&#123;</span><br><span class="line">        if(!this.clienlist[key])&#123;</span><br><span class="line">            this.clienlist[key]=[];</span><br><span class="line">        &#125;</span><br><span class="line">        this.clienlist[key].push(fn);</span><br><span class="line">    &#125;,</span><br><span class="line">    /**</span><br><span class="line">     * 发布消息</span><br><span class="line">     * */</span><br><span class="line">    trigger:function()&#123;</span><br><span class="line">        var key=[].shift.call(arguments),//取出消息类型</span><br><span class="line">            fns=this.clienlist[key];//取出该类型的对应的消息集合</span><br><span class="line">        if(!fns || fns.length===0)&#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        for(var i=0,fn;fn=fns[i++];)&#123;</span><br><span class="line">            fn.apply(this,arguments);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">//超级管理员修改所有用户</span><br><span class="line">var editall=(function()&#123;</span><br><span class="line">    login.addlisten(&quot;loginsucc&quot;,function(data)&#123;</span><br><span class="line">        editall.setview(data);</span><br><span class="line">    &#125;);</span><br><span class="line">    return&#123;</span><br><span class="line">        setview:function(data)&#123;</span><br><span class="line">            console.log(data);</span><br><span class="line">            console.log(&quot;超级管理员修改所有用户&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line">//仅仅修改自己</span><br><span class="line">var editOwn=(function()&#123;</span><br><span class="line">    login.addlisten(&quot;loginsucc&quot;,function(data)&#123;</span><br><span class="line">        editOwn.setview(data);</span><br><span class="line">    &#125;);</span><br><span class="line">    return&#123;</span><br><span class="line">        setview:function(data)&#123;</span><br><span class="line">            console.log(data);</span><br><span class="line">            console.log(&quot;仅仅修改自己&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>发布-订阅模式简单封装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">var _Event=(function()&#123;</span><br><span class="line">    var clienlist=&#123;&#125;,</span><br><span class="line">    addlisten,trigger,remove;</span><br><span class="line">    /**</span><br><span class="line">     * 增加订阅者</span><br><span class="line">     * @key &#123;String&#125; 类型</span><br><span class="line">     * @fn &#123;Function&#125; 回掉函数</span><br><span class="line">     * */</span><br><span class="line">    addlisten=function(key,fn)&#123;</span><br><span class="line">        if(!clienlist[key])&#123;</span><br><span class="line">            clienlist[key]=[];</span><br><span class="line">        &#125;</span><br><span class="line">        clienlist[key].push(fn);</span><br><span class="line">    &#125;;</span><br><span class="line">    /**</span><br><span class="line">     * 发布消息</span><br><span class="line">     * */</span><br><span class="line">    trigger=function()&#123;</span><br><span class="line">        var key=[].shift.call(arguments),//取出消息类型</span><br><span class="line">            fns=clienlist[key];//取出该类型的对应的消息集合</span><br><span class="line">        if(!fns || fns.length===0)&#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        for(var i=0,fn;fn=fns[i++];)&#123;</span><br><span class="line">            fn.apply(this,arguments);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    /**</span><br><span class="line">     * 删除订阅</span><br><span class="line">     * @key &#123;String&#125; 类型</span><br><span class="line">     * @fn &#123;Function&#125; 回掉函数</span><br><span class="line">     * */</span><br><span class="line">    remove=function(key,fn)&#123;</span><br><span class="line">        var fns=clienlist[key];//取出该类型的对应的消息集合</span><br><span class="line">        if(!fns)&#123;//如果对应的key没有订阅直接返回</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        if(!fn)&#123;//如果没有传入具体的回掉，则表示需要取消所有订阅</span><br><span class="line">            fns &amp;&amp; (fns.length=0);</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            for(var l=fns.length-1;l&gt;=0;l--)&#123;//遍历回掉函数列表</span><br><span class="line">                if(fn===fns[l])&#123;</span><br><span class="line">                    fns.splice(l,1);//删除订阅者的回掉</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    return&#123;</span><br><span class="line">        addlisten:addlisten,</span><br><span class="line">        trigger:trigger,</span><br><span class="line">        remove:remove</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">_Event.addlisten(&quot;jianbing&quot;,function(d,all)&#123;</span><br><span class="line">    console.log(&quot;发布的消息来自：&quot;+d+&quot;，具体信息：&quot;+all);</span><br><span class="line">&#125;);</span><br><span class="line">_Event.addlisten(&quot;jianbing&quot;,function(d,all)&#123;</span><br><span class="line">    console.log(&quot;发布的消息来自：&quot;+d+&quot;，具体信息：&quot;+all);</span><br><span class="line">&#125;)</span><br><span class="line">_Event.trigger(&quot;jianbing&quot;,&quot;小小坤&quot;,&quot;前端工程师，擅长JavaScript，喜欢结交更多的前端技术人员，欢迎喜欢技术的你加QQ群：198303871&quot;)</span><br></pre></td></tr></table></figure>
<p><img src="https://user-gold-cdn.xitu.io/2017/9/18/d107c914ae84c7a30bc25f7cfcd02448" alt=""></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p> 发布-订阅模式就是常说的观察者模式，在实际开发中非常有用。它的优点是为时间是解耦，为对象之间解构，它的应用非常广泛，既可以在异步编程中也可以帮助我们完成更松的解耦。发布-订阅模式还可以帮助我们实现设计模式，从架构上来看，无论MVC还是MVVC都少不了发布-订阅模式的参与。然而发布-订阅模式也存在一些缺点，创建订阅本身会消耗一定的时间与内存，也许当你订阅一个消息之后，之后可能就不会发生。发布-订阅模式虽然它弱化了对象与对象之间的关系，但是如果过度使用，对象与对象的必要联系就会被深埋，会导致程序难以跟踪与维护。</p>
<p> 打赏通道–我觉得不会有打赏。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/11/28/167592f13078d6a8?w=800&amp;h=600&amp;f=jpeg&amp;s=184358" alt=""></p>
<p><img src="https://user-gold-cdn.xitu.io/2018/4/14/162c4b13a41e4a3a?w=323&amp;h=311&amp;f=png&amp;s=83969" alt=""></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/16/about/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小小坤">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/log.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小小坤">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/16/about/" itemprop="url">关于我</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-08-16T16:50:01+08:00">
                2018-08-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">性别：男</span><br><span class="line">姓名：小小坤</span><br><span class="line">爱好：街舞，健身</span><br><span class="line">擅长：JavaScript设计模式</span><br><span class="line">联系：java-script@qq.com</span><br></pre></td></tr></table></figure>
<p>打赏通道–我觉得不会有打赏。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/11/28/167592f13078d6a8?w=800&amp;h=600&amp;f=jpeg&amp;s=184358" alt=""></p>
<p><img src="https://user-gold-cdn.xitu.io/2018/4/14/162c4b13a41e4a3a?w=323&amp;h=311&amp;f=png&amp;s=83969" alt=""></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/16/fanyi/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小小坤">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/log.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小小坤">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/16/fanyi/" itemprop="url">译：如何构造我的JavaScript文件?</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-16T16:30:00+08:00">
                2018-05-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>看到英文技术文档、快哭了。含着泪也要把他读完。<br>原文<a href="https://dev.to/antjanus/how-i-structure-my-javascript-file-2clc" target="_blank" rel="noopener">How I Structure My JavaScript File</a></p>
<h2 id="内容"><a href="#内容" class="headerlink" title="内容"></a>内容</h2><p>很多人都在问我怎么写我的JavaScript——好吧，这是一个谎言，没人问我，但是如果他们这么做了，我想指出这篇文章。在使用了多年的PHP之后，在阅读了干净代码(和其他书籍)之后，我在多年中采用了我的代码风格。是的，PHP，不要敲它，它有一个伟大的社区和伟大的编码标准。当然，多年来和别人一起写作，跟随不同公司的风格。</p>
<p>结构并不依赖于JS模块，但我现在倾向于只编写JS模块，所以我将使用这些模块。</p>
<p>结构，总结如下:</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/5/16/16366cd94d58104b?w=945&amp;h=738&amp;f=png&amp;s=46614" alt=""><br>入口</p>
<p>在文件的顶部是导入。这是有道理的，他们比其他任何东西都要高。进口的顺序无关紧要，除非你使用一些挂钩(比如babel hook)，所以我倾向于选择:</p>
<ol>
<li><p>本地模块-节点本地的东西。</p>
</li>
<li><p>库模块- lodash, knex，等等。</p>
</li>
<li><p>本地库——比如../db。</p>
</li>
<li><p>本地文件- like ./helper或类似的。</p>
</li>
</ol>
<p>让我的模块保持有序，让我更容易看到我在导入什么，以及我实际上在使用什么。当我开始编写代码时，我也倾向于以这种方式编写依赖关系。</p>
<p>我倾向于不关心字母排序(除了破坏导入之外)，我也没有看到它的一个点。</p>
<p>本地模块<br>我倾向于将本地模块放在最上面，并以这样的主题保持一个清晰的组织:</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/5/16/16366cfb16e2e4ea?w=827&amp;h=211&amp;f=png&amp;s=8988" alt=""><br>如果我在浏览器中，显然跳过这一步。</p>
<p>库模块</p>
<p>我尽可能只从库中导入我需要的东西，但是，我又一次将它们分组到某个主题中。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/5/16/16366d09cb84511b?w=871&amp;h=158&amp;f=png&amp;s=7726" alt=""><br>我还注意到，如果我正在执行一个默认的导入(例如。我倾向于把它放在我的库模块的顶部，并将被破坏的导入降低。没有必要，但我喜欢它的视觉效果。</p>
<p>Local/Internal libraries</p>
<p>在本地库中，我指的是本地共享的模块，比如db。设置与书架连接的js文件。或者，在我的工作中，我们有几个库处理我们产品中使用的数字和计算。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/5/16/16366d4c7b58bf0b?w=980&amp;h=163&amp;f=png&amp;s=9574" alt=""><br>Local files<br>最后，我导入本地文件，这些文件通常与我正在处理的文件或一个目录(最多)在同一个文件夹中。例如，我为Redux写了一个减速器，并把它放在一个单独的文件夹中。在该文件夹中，我还保留了一个助手文件，通常命名为[reducer name]Helpers.js:</p>
<p>Constants</p>
<p>在导入所有依赖项之后，我通常会做一些前期工作，这些工作将在模块的其余部分中使用。例如，我从书架实例中提取了knex。或者我可以设置值常数。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/5/16/16366d6053bdb4b0?w=957&amp;h=189&amp;f=png&amp;s=8592" alt=""><br>使用非常量通常表示我依赖于某种类型的单例。我尽量避免使用它们，但有时它是必要的，因为没有简单的其他方法来完成它，或者它不重要(比如一次性命令行脚本)。<br>Exports</p>
<p>在我基本设置了所有模块级别的依赖项之后:无论它们是常量值还是导入库，我都试着将我的导出分组到文件的顶部。基本上，这就是我把功能作为模块的粘合剂，实现模块的最终目的。</p>
<p>在Redux的情况下，我可能导出一个单一的减速器，然后将工作分解并调用相关的逻辑。在ExpressJS的情况下，我可能在这里导出所有的路由，而实际的路由逻辑在下面。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/5/16/16366d7248f64337?w=978&amp;h=343&amp;f=png&amp;s=29738" alt=""><br>我想说的是，这并不是我出口功能的唯一部分。</p>
<p>我感觉模块系统的工作方式使得在暴露最窄的API和导出函数在测试中使用它们之间的界限变得有点困难。</p>
<p>例如，在上面的例子中，我从来不想在模块之外使用calculateSomething。我不完全确定OOP语言是如何处理测试私有函数的，但这是一个类似的问题。<br>Core Logic</p>
<p>这看起来很奇怪，但核心逻辑对我来说是最重要的。我完全理解当人们翻转导出和核心逻辑时，但这对我来说很有效，原因有很多。</p>
<p>当我打开一个文件时，顶层函数会告诉我抽象步骤中将会发生什么。我很喜欢这样。我一眼就能看出文件的作用。我做了大量的CSV操作，并将其插入到DB中，而顶级函数始终是一个容易理解的流程，它有一个类似的流程:fetchCSV aggregateData insertData terminate script。</p>
<p>核心逻辑总是包括从上到下的出口。在内联的例子中，我们有这样的东西:</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/5/16/16366d832841c15e?w=1081&amp;h=826&amp;f=png&amp;s=49122" alt=""><br>注意，readCSV没有。这听起来很普通，我应该把它放到一个helper文件中，然后将它导入上面。除此之外，你可以看到我的出口，而不是进退两难。我不希望在模块外部提供聚合数据，但我仍然希望测试它。</p>
<p>在此之外，我倾向于把“meatier”函数放在上面，下面的函数更小。如果我有一个特定于模块的实用函数，一个我在多个地方使用的函数，但只在模块中使用，我将把它们放在底部。基本上，我的命令是:复杂性+使用。</p>
<p>所以顺序是:</p>
<ol>
<li><p>核心逻辑函数——由顶级导出使用的函数。</p>
</li>
<li><p>更简单/更小的函数——核心逻辑函数使用的函数。</p>
</li>
<li><p>实用函数——模块周围多个地方使用的小函数(但不导出)</p>
</li>
</ol>
<p>Core-logic functions<br>核心逻辑函数就像我导出的函数的“sub-glue”。根据模块的复杂性，这些可能存在，也可能不存在。功能的分解不是必需的，但是如果一个模块足够大，核心逻辑函数就像主函数中的步骤。</p>
<p>如果你写的是反应或角度，这些你的组件将是我上面提到的出口函数。但是，核心逻辑函数将是各种侦听器或数据处理器的实现。用Express，这些将是您的特定路线。在一个Redux减速器中，这些将是在链条上足够远的单独的减速器，没有一个开关/case语句。</p>
<p>如果您处于角度，那么在类中组织这些函数而不是在整个文件的范围内是完全公平的。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/5/16/16366da0d8aa4241?w=884&amp;h=260&amp;f=png&amp;s=14030" alt=""><br>Simpler/Smaller functions</p>
<p>这些函数通常是核心逻辑和纯实用程序之间的中间步骤。你可能会用到它们，或者它们可能只是一个比效用函数更复杂的tad。我可能会删除这个类别，并说“写你的功能，以减少复杂性或工作量”。</p>
<p>这里没有提及。也许onHandleInput事件监听器需要一些逻辑来处理$event数据，所以如果它是纯的，您可以将它从类中删除，如果不是，您可以在类中保留它:</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/5/16/16366dabd6dd82ed?w=1015&amp;h=525&amp;f=png&amp;s=27605" alt=""><br>Utility functions</p>
<p>最后,效用函数。我倾向于组织最接近我使用它们的工具。在相同的文件中，或者相同的文件夹(必要时)，相同的模块，等等。每次使用从文件中扩展到项目的根或它自己的NPM模块时，我都将函数移出一个级别。</p>
<p>在我看来，效用函数应该始终是一种纯方法，这意味着它不应该在它的范围之外访问变量，而且应该只依赖传递到它的数据，而且不需要任何形式的副作用。除非使用实用程序函数来访问API或访问数据库。因为这些被认为是副作用，所以我认为它们是唯一的例外。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/5/16/16366dbab502bf1f?w=992&amp;h=573&amp;f=png&amp;s=35270" alt=""><br>Anything else?<br>当然!我认为每个人都有自己独特的书写方式。上面所描述的结构在我多年来每天编写大量代码的过程中非常有效。最终，许多细微的差别开始出现，我发现自己编写代码更快，更喜欢它，并且更容易调试和测试。</p>
<p>在我完成这篇文章之前，我想和大家分享一些我已经习惯了的编码，它们与文档结构的关系更少，更多的是在编写实际代码时更倾向于使用小的偏好。</p>
<p>早期的回报</p>
<p>当我发现早期的回报时，那是一瞬间。当您可以提前返回时，为什么要在else语句中封装大量代码?</p>
<p>我的经验法则是，如果早期的返回条件小于其余的代码，那么我将写早期的返回，但是如果不是，我将颠倒代码，这样较小的代码块总是提前返回。<br><img src="https://user-gold-cdn.xitu.io/2018/5/16/16366dc7c2379da7?w=1028&amp;h=505&amp;f=png&amp;s=30527" alt=""><br>早期的回报在交换机上也很出色，我是Redux的超级粉丝。</p>
<p>分号块</p>
<p>虽然我不再使用它(没有更漂亮的支持)，但我总是用分号来终止函数链接，在一个单独的行上，一个缩进到链的缩进的左边。这就创建了一个整洁的代码块，代码不只是挂在那里。</p>
<p>当然，这意味着我也喜欢用分号来代替。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/5/16/16366dd4427b4752?w=858&amp;h=233&amp;f=png&amp;s=18784" alt=""><br>Or better written, it might look like this:</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/5/16/16366dd6ead74ded?w=909&amp;h=254&amp;f=png&amp;s=15393" alt=""></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>使用的是有道在线翻译，如有不正确之处还望大佬指出。</p>
<p>打赏通道–我觉得不会有打赏。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/11/28/167592f13078d6a8?w=800&amp;h=600&amp;f=jpeg&amp;s=184358" alt=""></p>
<p><img src="https://user-gold-cdn.xitu.io/2018/4/14/162c4b13a41e4a3a?w=323&amp;h=311&amp;f=png&amp;s=83969" alt=""></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/14/zhongjianjian/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小小坤">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/log.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小小坤">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/14/zhongjianjian/" itemprop="url">写一个简单vue 中间件，$emit、$on</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-14T10:50:01+08:00">
                2018-04-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>使用过vue的同学大多数都知道$emit 与$on的使用。我们仅仅知道使用，有时候是完全不够的。现在我就带领大家写一个简单类似于vue空实例的中间件。</p>
<h2 id="非父子组件的通信"><a href="#非父子组件的通信" class="headerlink" title="非父子组件的通信"></a>非父子组件的通信</h2><p>非父子组件的通信vue官网给出这样的解决方案。<br>有时候，非父子关系的两个组件之间也需要通信。在简单的场景下，可以使用一个空的 Vue 实例作为事件总线：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var bus = new Vue()</span><br><span class="line">// 触发组件 A 中的事件</span><br><span class="line">bus.$emit(&apos;id-selected&apos;, 1)</span><br><span class="line">// 在组件 B 创建的钩子中监听事件</span><br><span class="line">bus.$on(&apos;id-selected&apos;, function (id) &#123;</span><br><span class="line">  // ...</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><img src="https://user-gold-cdn.xitu.io/2018/4/14/162c4a3b7e25b7a1?w=654&amp;h=400&amp;f=png&amp;s=21329" alt=""></p>
<h2 id="简单例子"><a href="#简单例子" class="headerlink" title="简单例子"></a>简单例子</h2><p>下面是一个很简单的例子</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line">//工具</span><br><span class="line">var myBus = (function() &#123;</span><br><span class="line">	var clienlist = &#123;&#125;,</span><br><span class="line">		addlisten, trigger, remove;</span><br><span class="line">	/**</span><br><span class="line">	 * 增加订阅者</span><br><span class="line">	 * @key &#123;String&#125; 类型</span><br><span class="line">	 * @fn &#123;Function&#125; 回掉函数</span><br><span class="line">	 * */</span><br><span class="line">	addlisten = function(key, fn) &#123;</span><br><span class="line">		if(!clienlist[key]) &#123;</span><br><span class="line">			clienlist[key] = [];</span><br><span class="line">		&#125;</span><br><span class="line">		clienlist[key].push(fn);</span><br><span class="line">	&#125;;</span><br><span class="line">	/**</span><br><span class="line">	 * 发布消息</span><br><span class="line">	 * */</span><br><span class="line">	trigger = function() &#123;</span><br><span class="line">		var key = [].shift.call(arguments), //取出消息类型</span><br><span class="line">			fns = clienlist[key]; //取出该类型的对应的消息集合</span><br><span class="line">		if(!fns || fns.length === 0) &#123;</span><br><span class="line">			return false;</span><br><span class="line">		&#125;</span><br><span class="line">		for(var i = 0, fn; fn = fns[i++];) &#123;</span><br><span class="line">			fn.apply(this, arguments);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;;</span><br><span class="line">	/**</span><br><span class="line">	 * 删除订阅</span><br><span class="line">	 * @key &#123;String&#125; 类型</span><br><span class="line">	 * @fn &#123;Function&#125; 回掉函数</span><br><span class="line">	 * */</span><br><span class="line">	remove = function(key, fn) &#123;</span><br><span class="line">		var fns = clienlist[key]; //取出该类型的对应的消息集合</span><br><span class="line">		if(!fns) &#123; //如果对应的key没有订阅直接返回</span><br><span class="line">			return false;</span><br><span class="line">		&#125;</span><br><span class="line">		if(!fn) &#123; //如果没有传入具体的回掉，则表示需要取消所有订阅</span><br><span class="line">			fns &amp;&amp; (fns.length = 0);</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			for(var l = fns.length - 1; l &gt;= 0; l--) &#123; //遍历回掉函数列表</span><br><span class="line">				if(fn === fns[l]) &#123;</span><br><span class="line">					fns.splice(l, 1); //删除订阅者的回掉</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;;</span><br><span class="line">	return &#123;</span><br><span class="line">		$on: addlisten,</span><br><span class="line">		$emit: trigger,</span><br><span class="line">		$off: remove</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)();</span><br><span class="line">//组件一</span><br><span class="line">Vue.component(&apos;vv-count&apos;, &#123;</span><br><span class="line">	props: [&quot;count&quot;],</span><br><span class="line">	template: &apos;&lt;div&gt;\</span><br><span class="line">                 &lt;span&gt;&#123;&#123;count&#125;&#125;&lt;/span&gt;&lt;button @click=&quot;handelClick&quot; type=&quot;button&quot;&gt;计算&lt;/button&gt;\</span><br><span class="line">               &lt;/div&gt;&apos;,</span><br><span class="line">	methods: &#123;</span><br><span class="line">		handelClick() &#123;</span><br><span class="line">			console.log(&apos;vv-count总计：&apos;, this.count);</span><br><span class="line"></span><br><span class="line">			if(vue_bus)&#123;</span><br><span class="line">			 	//触发发布--使用vue</span><br><span class="line">			    bus.$emit(&quot;vv_count&quot;, this.count,&apos;这是使用vue的&apos;)</span><br><span class="line">			 &#125;else&#123;</span><br><span class="line">			 	//触发发布--使用自己的</span><br><span class="line">			    myBus.$emit(&quot;vv_count&quot;, this.count,&apos;这是自己写的&apos;)</span><br><span class="line">			 &#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br><span class="line">//组件二</span><br><span class="line">Vue.component(&apos;vv-count1&apos;, &#123;</span><br><span class="line">	props: [&quot;count&quot;],</span><br><span class="line">	template: &apos;&lt;div&gt;\</span><br><span class="line">                 &lt;span&gt;&#123;&#123;count&#125;&#125;&lt;/span&gt;&lt;button @click=&quot;handelClick&quot; type=&quot;button&quot;&gt;计算&lt;/button&gt;\</span><br><span class="line">               &lt;/div&gt;&apos;,</span><br><span class="line">	methods: &#123;</span><br><span class="line">		handelClick() &#123;</span><br><span class="line">			console.log(&apos;vv-count1总计：&apos;, this.count);</span><br><span class="line">			 </span><br><span class="line">			 if(vue_bus)&#123;</span><br><span class="line">			 	//触发发布</span><br><span class="line">			    bus.$emit(&quot;vv_count&quot;, this.count)</span><br><span class="line">			 &#125;else&#123;</span><br><span class="line">			 	//触发发布</span><br><span class="line">			    myBus.$emit(&quot;vv_count&quot;, this.count)</span><br><span class="line">			 &#125;</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">var vue_bus=true;// true：使用vue的事件总线，false:使用自己的事件总线</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if(vue_bus)&#123;</span><br><span class="line">	//中间件</span><br><span class="line">	var bus = new Vue();</span><br><span class="line">	//使用vue的事件总线--订阅</span><br><span class="line">	bus.$on(&quot;vv_count&quot;, function() &#123;</span><br><span class="line">		console.log(&quot;使用bus发布的参数==&quot;, arguments);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">	//使用自己的事件总线--订阅</span><br><span class="line">	myBus.$on(&quot;vv_count&quot;, function() &#123;</span><br><span class="line">		console.log(&quot;使用myBus发布的参数==&quot;, arguments);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">new Vue(&#123;</span><br><span class="line">	el: &quot;#app&quot;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>上面代码可以使用vue_bus=true 或者false 相互切换进行看效果。如图所示：</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/4/14/162c4a8d2edfd3f3?w=672&amp;h=496&amp;f=png&amp;s=21593" alt=""><br>如果想看更加详细的讲解请预览<a href="https://juejin.im/post/59bf4ff9f265da064b46e508" target="_blank" rel="noopener">发布-订阅模式  </a> or <a href="http://www.cnblogs.com/xiaoxiaokun/p/7294437.html" target="_blank" rel="noopener">发布-订阅模式  </a></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>vue中的发布订阅跟自己写的发布订阅原理是相同的，希望大家能够get到知识。</p>
<p>打赏通道–我觉得不会有打赏。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/11/28/167592f13078d6a8?w=800&amp;h=600&amp;f=jpeg&amp;s=184358" alt=""></p>
<p><img src="https://user-gold-cdn.xitu.io/2018/4/14/162c4b13a41e4a3a?w=323&amp;h=311&amp;f=png&amp;s=83969" alt=""></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/12/reander/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小小坤">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/log.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小小坤">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/12/reander/" itemprop="url">Vue render深入窥探之谜</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-03-12T10:50:01+08:00">
                2018-03-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>在使用Vue进行开发的时候，大多数情况下都是使用template进行开发，使用template简单、方便、快捷，可是有时候需要特殊的场景使用template就不是很适合。因此为了很好使用render函数，我决定深入窥探一下。各位看官如果觉得下面写的有不正确之处还望看官指出，你们与我的互动就是写作的最大动力。<br>首发于：<a href="http://www.cnblogs.com/xiaoxiaokun/p/8808783.html" target="_blank" rel="noopener">Vue render深入窥探之谜</a></p>
<h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>官网描述的场景当我们开始写一个通过 level prop 动态生成 heading 标签的组件，你可能很快想到这样实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=&quot;text/x-template&quot; id=&quot;anchored-heading-template&quot;&gt;</span><br><span class="line">  &lt;h1 v-if=&quot;level === 1&quot;&gt;</span><br><span class="line">    &lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">  &lt;/h1&gt;</span><br><span class="line">  &lt;h2 v-else-if=&quot;level === 2&quot;&gt;</span><br><span class="line">    &lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">  &lt;/h2&gt;</span><br><span class="line">  &lt;h3 v-else-if=&quot;level === 3&quot;&gt;</span><br><span class="line">    &lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">  &lt;/h3&gt;</span><br><span class="line">  &lt;h4 v-else-if=&quot;level === 4&quot;&gt;</span><br><span class="line">    &lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">  &lt;/h4&gt;</span><br><span class="line">  &lt;h5 v-else-if=&quot;level === 5&quot;&gt;</span><br><span class="line">    &lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">  &lt;/h5&gt;</span><br><span class="line">  &lt;h6 v-else-if=&quot;level === 6&quot;&gt;</span><br><span class="line">    &lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">  &lt;/h6&gt;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Vue.component(&apos;anchored-heading&apos;, &#123;</span><br><span class="line">  template: &apos;#anchored-heading-template&apos;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    level: &#123;</span><br><span class="line">      type: Number,</span><br><span class="line">      required: true</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>在这种场景中使用 template 并不是最好的选择：首先代码冗长，为了在不同级别的标题中插入锚点元素，我们需要重复地使用 <slot></slot>。</p>
<p>虽然模板在大多数组件中都非常好用，但是在这里它就不是很简洁的了。那么，我们来尝试使用 render 函数重写上面的例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Vue.component(&apos;anchored-heading&apos;, &#123;</span><br><span class="line">  render: function (createElement) &#123;</span><br><span class="line">    return createElement(</span><br><span class="line">      &apos;h&apos; + this.level,   // tag name 标签名称</span><br><span class="line">      this.$slots.default // 子组件中的阵列</span><br><span class="line">    )</span><br><span class="line">  &#125;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    level: &#123;</span><br><span class="line">      type: Number,</span><br><span class="line">      required: true</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>简单清晰很多！简单来说，这样代码精简很多，但是需要非常熟悉 Vue 的实例属性。在这个例子中，你需要知道当你不使用 slot 属性向组件中传递内容时，比如 anchored-heading 中的 Hello world!，这些子元素被存储在组件实例中的 $slots.default中。</p>
<h2 id="createElement参数介绍"><a href="#createElement参数介绍" class="headerlink" title="createElement参数介绍"></a>createElement参数介绍</h2><p>接下来你需要熟悉的是如何在 createElement 函数中生成模板。这里是 createElement 接受的参数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">createElement(</span><br><span class="line">  // &#123;String | Object | Function&#125;</span><br><span class="line">  // 一个 HTML 标签字符串，组件选项对象，或者</span><br><span class="line">  // 解析上述任何一种的一个 async 异步函数，必要参数。</span><br><span class="line">  &apos;div&apos;,</span><br><span class="line"></span><br><span class="line">  // &#123;Object&#125;</span><br><span class="line">  // 一个包含模板相关属性的数据对象</span><br><span class="line">  // 这样，您可以在 template 中使用这些属性。可选参数。</span><br><span class="line">  &#123;</span><br><span class="line">    // (详情见下一节)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  // &#123;String | Array&#125;</span><br><span class="line">  // 子节点 (VNodes)，由 `createElement()` 构建而成，</span><br><span class="line">  // 或使用字符串来生成“文本节点”。可选参数。</span><br><span class="line">  [</span><br><span class="line">    &apos;先写一些文字&apos;,</span><br><span class="line">    createElement(&apos;h1&apos;, &apos;一则头条&apos;),</span><br><span class="line">    createElement(MyComponent, &#123;</span><br><span class="line">      props: &#123;</span><br><span class="line">        someProp: &apos;foobar&apos;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h3 id="深入-data-对象"><a href="#深入-data-对象" class="headerlink" title="深入 data 对象"></a>深入 data 对象</h3><p>有一件事要注意：正如在模板语法中，v-bind:class 和 v-bind:style ，会被特别对待一样，在 VNode 数据对象中，下列属性名是级别最高的字段。该对象也允许你绑定普通的 HTML 特性，就像 DOM 属性一样，比如 innerHTML (这会取代 v-html 指令)。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  // 和`v-bind:class`一样的 API</span><br><span class="line">  &apos;class&apos;: &#123;</span><br><span class="line">    foo: true,</span><br><span class="line">    bar: false</span><br><span class="line">  &#125;,</span><br><span class="line">  // 和`v-bind:style`一样的 API</span><br><span class="line">  style: &#123;</span><br><span class="line">    color: &apos;red&apos;,</span><br><span class="line">    fontSize: &apos;14px&apos;</span><br><span class="line">  &#125;,</span><br><span class="line">  // 正常的 HTML 特性</span><br><span class="line">  attrs: &#123;</span><br><span class="line">    id: &apos;foo&apos;</span><br><span class="line">  &#125;,</span><br><span class="line">  // 组件 props</span><br><span class="line">  props: &#123;</span><br><span class="line">    myProp: &apos;bar&apos;</span><br><span class="line">  &#125;,</span><br><span class="line">  // DOM 属性</span><br><span class="line">  domProps: &#123;</span><br><span class="line">    innerHTML: &apos;baz&apos;</span><br><span class="line">  &#125;,</span><br><span class="line">  // 事件监听器基于 `on`</span><br><span class="line">  // 所以不再支持如 `v-on:keyup.enter` 修饰器</span><br><span class="line">  // 需要手动匹配 keyCode。</span><br><span class="line">  on: &#123;</span><br><span class="line">    click: this.clickHandler</span><br><span class="line">  &#125;,</span><br><span class="line">  // 仅对于组件，用于监听原生事件，而不是组件内部使用</span><br><span class="line">  // `vm.$emit` 触发的事件。</span><br><span class="line">  nativeOn: &#123;</span><br><span class="line">    click: this.nativeClickHandler</span><br><span class="line">  &#125;,</span><br><span class="line">  // 自定义指令。注意，你无法对 `binding` 中的 `oldValue`</span><br><span class="line">  // 赋值，因为 Vue 已经自动为你进行了同步。</span><br><span class="line">  directives: [</span><br><span class="line">    &#123;</span><br><span class="line">      name: &apos;my-custom-directive&apos;,</span><br><span class="line">      value: &apos;2&apos;,</span><br><span class="line">      expression: &apos;1 + 1&apos;,</span><br><span class="line">      arg: &apos;foo&apos;,</span><br><span class="line">      modifiers: &#123;</span><br><span class="line">        bar: true</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  // Scoped slots in the form of</span><br><span class="line">  // &#123; name: props =&gt; VNode | Array&lt;VNode&gt; &#125;</span><br><span class="line">  scopedSlots: &#123;</span><br><span class="line">    default: props =&gt; createElement(&apos;span&apos;, props.text)</span><br><span class="line">  &#125;,</span><br><span class="line">  // 如果组件是其他组件的子组件，需为插槽指定名称</span><br><span class="line">  slot: &apos;name-of-slot&apos;,</span><br><span class="line">  // 其他特殊顶层属性</span><br><span class="line">  key: &apos;myKey&apos;,</span><br><span class="line">  ref: &apos;myRef&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="条件渲染"><a href="#条件渲染" class="headerlink" title="条件渲染"></a>条件渲染</h2><p>既然熟读以上api接下来咱们就来点实战。<br>之前这样写<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">//HTML</span><br><span class="line">&lt;div id=&quot;app&quot;&gt;</span><br><span class="line">   &lt;vv-isshow :show=&quot;isShow&quot;&gt;&lt;/vv-isshow&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">//js</span><br><span class="line">//组件形式			</span><br><span class="line">Vue.component(&apos;vv-isshow&apos;, &#123;</span><br><span class="line">	props:[&apos;show&apos;],</span><br><span class="line">	template:&apos;&lt;div v-if=&quot;show&quot;&gt;我被你发现啦2！！！&lt;/div&gt;&apos;,</span><br><span class="line">&#125;);</span><br><span class="line">var vm = new Vue(&#123;</span><br><span class="line">	el: &quot;#app&quot;,</span><br><span class="line">	data: &#123;</span><br><span class="line">		isShow:true</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>render这样写</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">//HTML</span><br><span class="line">&lt;div id=&quot;app&quot;&gt;</span><br><span class="line">   &lt;vv-isshow :show=&quot;isShow&quot;&gt;&lt;slot&gt;我被你发现啦3！！！&lt;/slot&gt;&lt;/vv-isshow&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">//js</span><br><span class="line">//组件形式			</span><br><span class="line">Vue.component(&apos;vv-isshow&apos;, &#123;</span><br><span class="line">	props:&#123;</span><br><span class="line">		show:&#123;</span><br><span class="line">			type: Boolean,</span><br><span class="line">			default: true</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	render:function(h)&#123;	</span><br><span class="line">		if(this.show ) return h(&apos;div&apos;,this.$slots.default);</span><br><span class="line">	&#125;,</span><br><span class="line">&#125;);</span><br><span class="line">var vm = new Vue(&#123;</span><br><span class="line">	el: &quot;#app&quot;,</span><br><span class="line">	data: &#123;</span><br><span class="line">		isShow:true</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="列表渲染"><a href="#列表渲染" class="headerlink" title="列表渲染"></a>列表渲染</h2><p>之前是这样写的，而且v-for 时template内必须被一个标签包裹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">//HTML</span><br><span class="line">&lt;div id=&quot;app&quot;&gt;</span><br><span class="line">   &lt;vv-aside v-bind:list=&quot;list&quot;&gt;&lt;/vv-aside&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">//js</span><br><span class="line">//组件形式			</span><br><span class="line">Vue.component(&apos;vv-aside&apos;, &#123;</span><br><span class="line">	props:[&apos;list&apos;],</span><br><span class="line">	methods:&#123;</span><br><span class="line">		handelClick(item)&#123;</span><br><span class="line">			console.log(item);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	template:&apos;&lt;div&gt;\</span><br><span class="line">	              &lt;div v-for=&quot;item in list&quot; @click=&quot;handelClick(item)&quot; :class=&quot;&#123;odd:item.odd&#125;&quot;&gt;&#123;&#123;item.txt&#125;&#125;&lt;/div&gt;\</span><br><span class="line">	          &lt;/div&gt;&apos;,</span><br><span class="line">	//template:&apos;&lt;div v-for=&quot;item in list&quot; @click=&quot;handelClick(item)&quot; :class=&quot;&#123;odd:item.odd&#125;&quot;&gt;&#123;&#123;item.txt&#125;&#125;&lt;/div&gt;&apos;,错误          </span><br><span class="line">&#125;);</span><br><span class="line">var vm = new Vue(&#123;</span><br><span class="line">	el: &quot;#app&quot;,</span><br><span class="line">	data: &#123;</span><br><span class="line">		list: [&#123;</span><br><span class="line">			id: 1,</span><br><span class="line">			txt: &apos;javaScript&apos;,</span><br><span class="line">			odd: true</span><br><span class="line">		&#125;, &#123;</span><br><span class="line">			id: 2,</span><br><span class="line">			txt: &apos;Vue&apos;,</span><br><span class="line">			odd: false</span><br><span class="line">		&#125;, &#123;</span><br><span class="line">			id: 3,</span><br><span class="line">			txt: &apos;React&apos;,</span><br><span class="line">			odd: true</span><br><span class="line">		&#125;]</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>render这样写</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">//HTML</span><br><span class="line">&lt;div id=&quot;app&quot;&gt;</span><br><span class="line">   &lt;vv-aside v-bind:list=&quot;list&quot;&gt;&lt;/vv-aside&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">//js</span><br><span class="line">//侧边栏</span><br><span class="line">Vue.component(&apos;vv-aside&apos;, &#123;</span><br><span class="line">	render: function(h) &#123;</span><br><span class="line">		var _this = this,</span><br><span class="line">			ayy = this.list.map((v) =&gt; &#123;</span><br><span class="line">				return h(&apos;div&apos;, &#123;</span><br><span class="line">					&apos;class&apos;: &#123;</span><br><span class="line">						odd: v.odd</span><br><span class="line">					&#125;,</span><br><span class="line">					attrs: &#123;</span><br><span class="line">						title: v.txt</span><br><span class="line">					&#125;,</span><br><span class="line">					on: &#123;</span><br><span class="line">						click: function() &#123;</span><br><span class="line">							return _this.handelClick(v);</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;, v.txt);</span><br><span class="line">			&#125;);</span><br><span class="line">		return h(&apos;div&apos;, ayy);</span><br><span class="line"></span><br><span class="line">	&#125;,</span><br><span class="line">	props: &#123;</span><br><span class="line">		list: &#123;</span><br><span class="line">			type: Array,</span><br><span class="line">			default: () =&gt; &#123;</span><br><span class="line">				return this.list || [];</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	methods: &#123;</span><br><span class="line">		handelClick: function(item) &#123;</span><br><span class="line">			console.log(item, &quot;item&quot;);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br><span class="line">var vm = new Vue(&#123;</span><br><span class="line">	el: &quot;#app&quot;,</span><br><span class="line">	data: &#123;</span><br><span class="line">		list: [&#123;</span><br><span class="line">			id: 1,</span><br><span class="line">			txt: &apos;javaScript&apos;,</span><br><span class="line">			odd: true</span><br><span class="line">		&#125;, &#123;</span><br><span class="line">			id: 2,</span><br><span class="line">			txt: &apos;Vue&apos;,</span><br><span class="line">			odd: false</span><br><span class="line">		&#125;, &#123;</span><br><span class="line">			id: 3,</span><br><span class="line">			txt: &apos;React&apos;,</span><br><span class="line">			odd: true</span><br><span class="line">		&#125;]</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="v-model"><a href="#v-model" class="headerlink" title="v-model"></a>v-model</h2><p>之前的写法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">//HTML</span><br><span class="line">&lt;div id=&quot;app&quot;&gt;</span><br><span class="line">	&lt;vv-models v-model=&quot;txt&quot; :txt=&quot;txt&quot;&gt;&lt;/vv-models&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">//js</span><br><span class="line">//input</span><br><span class="line">Vue.component(&apos;vv-models&apos;, &#123;</span><br><span class="line">	props: [&apos;txt&apos;],</span><br><span class="line">	template: &apos;&lt;div&gt;\</span><br><span class="line">				  &lt;p&gt;看官你输入的是:&#123;&#123;txtcout&#125;&#125;&lt;/p&gt;\</span><br><span class="line">	              &lt;input v-model=&quot;txtcout&quot; type=&quot;text&quot; /&gt;\</span><br><span class="line">	          &lt;/div&gt;&apos;,</span><br><span class="line">	computed: &#123;</span><br><span class="line">		txtcout:&#123;</span><br><span class="line">			get()&#123;</span><br><span class="line">				return this.txt;</span><br><span class="line">			&#125;,</span><br><span class="line">			set(val)&#123;</span><br><span class="line">				this.$emit(&apos;input&apos;, val);</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br><span class="line">var vm = new Vue(&#123;</span><br><span class="line">	el: &quot;#app&quot;,</span><br><span class="line">	data: &#123;</span><br><span class="line">	    txt: &apos;&apos;, </span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>render这样写</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">//HTML</span><br><span class="line">&lt;div id=&quot;app&quot;&gt;</span><br><span class="line">	&lt;vv-models v-model=&quot;txt&quot; :txt=&quot;txt&quot;&gt;&lt;/vv-models&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">//js</span><br><span class="line">//input</span><br><span class="line">Vue.component(&apos;vv-models&apos;, &#123;</span><br><span class="line">	props: &#123;</span><br><span class="line">		txt: &#123;</span><br><span class="line">			type: String,</span><br><span class="line">			default: &apos;&apos;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	render: function(h) &#123;</span><br><span class="line">		var self=this;</span><br><span class="line">		return h(&apos;div&apos;,[h(&apos;p&apos;,&apos;你猜我输入的是啥：&apos;+this.txt),h(&apos;input&apos;,&#123;</span><br><span class="line">			on:&#123;</span><br><span class="line">				input(event)&#123;</span><br><span class="line">                    self.$emit(&apos;input&apos;, event.target.value);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;)] );</span><br><span class="line">	&#125;,</span><br><span class="line">&#125;);</span><br><span class="line">var vm = new Vue(&#123;</span><br><span class="line">	el: &quot;#app&quot;,</span><br><span class="line">	data: &#123;</span><br><span class="line">	    txt: &apos;&apos;, </span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>render函数使用的是JavaScript 的完全编程的能力，在性能上是占用绝对的优势，小编只是对它进行剖析。至于实际项目你选择那种方式进行渲染依旧需要根据你的项目以及实际情况而定。</p>
<p>打赏通道–我觉得不会有打赏。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/11/28/167592f13078d6a8?w=800&amp;h=600&amp;f=jpeg&amp;s=184358" alt=""></p>
<p><img src="https://user-gold-cdn.xitu.io/2018/4/14/162c4b13a41e4a3a?w=323&amp;h=311&amp;f=png&amp;s=83969" alt=""></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/02/11/map/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小小坤">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/log.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小小坤">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/11/map/" itemprop="url">如何实现一个地图库封装，可以快速切换地图</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-02-11T13:50:01+08:00">
                2018-02-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>日前在公司负责的主要业务是gis开发相关，现在使用的是百度地图，百度地图相比高德地图总有些缓慢、卡顿、因此才想到了这个方案。实现一个自己的库，可以快速切换百度地图与高德地图。</p>
<h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><p>有了上面这个需求，我们就在考虑这个需求涉及到的功能点，然后如何去实现它。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">一：配置项，一键配置可以选择加载。比如maptype=1：加载百度地图，maptype=2：加载高德地图</span><br><span class="line">二：百度如何平滑切换到高德  </span><br><span class="line">三：百度提供的构造函数与map下的方法如何兼容高德</span><br></pre></td></tr></table></figure>
<h2 id="最初架构"><a href="#最初架构" class="headerlink" title="最初架构"></a>最初架构</h2><p>有了上述需求和思路，接下来就是使用代码来实现，首先我想到的是，既然是一个库，那肯定要避免全局变量污染，还有就是可拓展性要强，代码整体性能要高。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 作者：java-script@qq.com</span><br><span class="line"> * 时间：2018-03-14</span><br><span class="line"> * 描述：百度与高德地图简单封装实现快速切换</span><br><span class="line"> * 版本：1.0.0.1</span><br><span class="line"> * </span><br><span class="line"> * */</span><br><span class="line">;(function()&#123;</span><br><span class="line">	&apos;use strict&apos;;</span><br><span class="line">	var arg = arguments,</span><br><span class="line">		win = arg[0] || window,</span><br><span class="line">		mapLsit = arg[1] || [];</span><br><span class="line">		</span><br><span class="line">&#125;)(window,[function()&#123;</span><br><span class="line">	</span><br><span class="line">&#125;,function()&#123;</span><br><span class="line">	</span><br><span class="line">&#125;]);</span><br></pre></td></tr></table></figure>
<p>上述架构只是一个立即执行函数，两个参数，第一个是window对象，第二个是数组，数组内是两个函数。第一个函数是//百度地图相关方法封装，第二个函数是//高德地图相关方法封装，也许以后还有实现腾讯地图封装。所有这里可以很简单的拓展。</p>
<h2 id="总体代码"><a href="#总体代码" class="headerlink" title="总体代码"></a>总体代码</h2><p>这是总体代码设计，代码还不是很完善，有的控件需要单独封装成工具，有的百度地图提供的插件高德没有提供，需要自己手写。比如下面都有自己手写的在地图上拉框进行搜索。拉框完毕触发回调，返回你拉框的区域位置，你可以在回调中处理你相关操作。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 作者：java-script@qq.com</span><br><span class="line"> * 时间：2018-03-14</span><br><span class="line"> * 描述：百度与高德地图简单封装实现快速切换</span><br><span class="line"> * 版本：1.0.0.1</span><br><span class="line"> * </span><br><span class="line"> * */</span><br><span class="line">;</span><br><span class="line">(function() &#123;</span><br><span class="line">	&apos;use strict&apos;;</span><br><span class="line">	var arg = arguments,</span><br><span class="line">		win = arg[0] || window,</span><br><span class="line">		mapLsit = arg[1] || [];</span><br><span class="line"></span><br><span class="line">	//console.log(mapLsit);</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 挂载window</span><br><span class="line">	 * */</span><br><span class="line">	var map = win.Gis_Map = &#123;&#125;;</span><br><span class="line">	/**</span><br><span class="line">	 * 配置项</span><br><span class="line">	 * */</span><br><span class="line">	map.config = &#123;</span><br><span class="line">		maptype: 0, //0:代表百度地图，1：高德地图，2：腾讯地图</span><br><span class="line">	&#125;;</span><br><span class="line">	//地图实例之后的所有方法</span><br><span class="line">	map.pulic = &#123;</span><br><span class="line"></span><br><span class="line">	&#125;;</span><br><span class="line">	/**</span><br><span class="line">	 * 主函数</span><br><span class="line">	 * </span><br><span class="line">	 * */</span><br><span class="line">	map.init = function() &#123;</span><br><span class="line">		main();</span><br><span class="line">	&#125;;</span><br><span class="line">	/**</span><br><span class="line">	 * 根据配置文件选择加载相应的地图</span><br><span class="line">	 * </span><br><span class="line">	 * */</span><br><span class="line">	function main() &#123;</span><br><span class="line"></span><br><span class="line">		switch(map.config.maptype) &#123;</span><br><span class="line">			case 0:</span><br><span class="line">				casemap(0);</span><br><span class="line">				break;</span><br><span class="line">			case 1:</span><br><span class="line">				casemap(1);</span><br><span class="line">				break;</span><br><span class="line">			case 2:</span><br><span class="line">				casemap(2);</span><br><span class="line">				break;</span><br><span class="line">			default:</span><br><span class="line"></span><br><span class="line">		&#125;;</span><br><span class="line">		/**</span><br><span class="line">		 * 选择加载</span><br><span class="line">		 * @n &#123;number&#125; 根据类型加载地图</span><br><span class="line">		 * </span><br><span class="line">		 * */</span><br><span class="line">		function casemap(n) &#123;</span><br><span class="line">			var fn = null;</span><br><span class="line">			if(mapLsit.length) &#123;</span><br><span class="line">				fn = mapLsit[n];</span><br><span class="line">				mapLsit = null;</span><br><span class="line">				fn.call(map);</span><br><span class="line">				//console.log(fn.call(map),&apos;加载百度地图成功！&apos;);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 把地图实例的方法进行统一</span><br><span class="line">	 * @n &#123;number&#125; 0:代表百度地图，1：代表高德地图</span><br><span class="line">	 * */</span><br><span class="line">	map.setpulic = function(n) &#123;</span><br><span class="line">		var map_pulic = this.pulic;</span><br><span class="line">		if(n === 0) &#123;</span><br><span class="line"></span><br><span class="line">		&#125; else if(n === 1) &#123;</span><br><span class="line">			//兼容高德设置中心点位与缩放大小</span><br><span class="line">			/**</span><br><span class="line">			 * @point &#123;point&#125; 点位</span><br><span class="line">			 * @level &#123;number&#125; 缩放大小等级</span><br><span class="line">			 * */</span><br><span class="line">			map_pulic.centerAndZoom = function(point, level) &#123;</span><br><span class="line">				this.setZoomAndCenter(level, point);</span><br><span class="line">			&#125;</span><br><span class="line">			/**</span><br><span class="line">			 * 启用缩放</span><br><span class="line">			 * </span><br><span class="line">			 * */</span><br><span class="line">			map_pulic.enableScrollWheelZoom = function() &#123;</span><br><span class="line"></span><br><span class="line">			&#125;</span><br><span class="line">			//兼容高德的绑定事件</span><br><span class="line">			map_pulic.addEventListener = map_pulic.on;</span><br><span class="line">			//兼容高德的添加覆盖物</span><br><span class="line">			map_pulic.addOverlay = map_pulic.add;</span><br><span class="line">			//清除 覆盖物</span><br><span class="line">			map_pulic.removeOverlay = map_pulic.remove;</span><br><span class="line">			//获取两点间距离 需要插件提供	</span><br><span class="line">			//map_pulic.getDistance=</span><br><span class="line"></span><br><span class="line">			//关闭window 窗体 </span><br><span class="line">			map_pulic.closeInfoWindow = map_pulic.clearInfoWindow;</span><br><span class="line"></span><br><span class="line">			/**</span><br><span class="line">			 * 地图经纬度坐标转换为平面地图像素坐标</span><br><span class="line">			 * lnglatToPixel</span><br><span class="line">			 * @point &#123;Point&#125; 点位</span><br><span class="line">			 * */</span><br><span class="line">			map_pulic.pointToPixel = function(point) &#123;</span><br><span class="line">				return map_pulic.lnglatToPixel(point, 10);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			/**</span><br><span class="line">			 * 获取两点间的距离</span><br><span class="line">			 * @start &#123;Point&#125; 开始点位</span><br><span class="line">			 * @end &#123;Point&#125; 结束点位</span><br><span class="line">			 * */</span><br><span class="line">			map_pulic.getDistance = function(start, end) &#123;</span><br><span class="line">				return start.distance(end);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		//console.log(map_pulic,&apos;map_pulic&apos;);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;)(window, [function() &#123;</span><br><span class="line">	&apos;use strict&apos;;</span><br><span class="line">	//百度地图相关方法封装</span><br><span class="line">	if(!BMap) &#123;</span><br><span class="line">		console.error(&apos;请检查config配置项与加载的地图js是否正确!&apos;);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	//验证数据类型</span><br><span class="line">	var _toString = Object.prototype.toString;</span><br><span class="line">	/**</span><br><span class="line">	 * 在指定的容器内创建地图实例，之后需要调用Map.centerAndZoom()方法对地图进行初始化。未进行初始化的地图将不能进行任何操作</span><br><span class="line">	 * @container &#123;String | HTMLElement&#125; </span><br><span class="line">	 * @opt &#123;</span><br><span class="line">	 * 	属性	              类型	                                   描述</span><br><span class="line">		minZoom	Number	地图允许展示的最小级别</span><br><span class="line">		maxZoom	Number	地图允许展示的最大级别</span><br><span class="line">		mapType	MapType	地图类型，默认为BMAP_NORMAL_MAP</span><br><span class="line">		enableHighResolution	Boolean	是否启用使用高分辨率地图。在iPhone4及其后续设备上，可以通过开启此选项获取更高分辨率的底图，v1.2,v1.3版本默认不开启，v1.4默认为开启状态</span><br><span class="line">		enableAutoResize	Boolean	是否自动适应地图容器变化，默认启用</span><br><span class="line">		enableMapClick	Boolean	是否开启底图可点功能，默认启用</span><br><span class="line">		PanOptions</span><br><span class="line">	 * &#125; 此类表示Map构造函数的可选参数。它没有构造函数，但可通过对象字面量形式表示。</span><br><span class="line">	 * */</span><br><span class="line">	this.Map = function(container, opt) &#123;</span><br><span class="line">		var that = this.pulic = new BMap.Map(container, opt);</span><br><span class="line">		//触发实例方法进行重写</span><br><span class="line">		this.setpulic(0);</span><br><span class="line">		return that;</span><br><span class="line">	&#125;</span><br><span class="line">	/**</span><br><span class="line">	 * 创建点位</span><br><span class="line">	 * @lng &#123;Number&#125;  地理经度</span><br><span class="line">	 * @lat &#123;Number&#125;  地理纬度</span><br><span class="line">	 * */</span><br><span class="line">	this.Point = function(lng, lat) &#123;</span><br><span class="line">		return new BMap.Point(lng, lat); //创建点位</span><br><span class="line">	&#125;</span><br><span class="line">	/**</span><br><span class="line">	 * 创建圆</span><br><span class="line">	 * </span><br><span class="line">	 * @center &#123;点位坐标 Point &#125; 以指定的经度和纬度创建一个地理点坐标</span><br><span class="line">	 * @radius &#123;Number&#125; 半径单位米</span><br><span class="line">	 * @opts  &#123;</span><br><span class="line">	 * 	strokeColor	String	圆形边线颜色</span><br><span class="line">		fillColor	String	圆形填充颜色。当参数为空时，圆形将没有填充效果</span><br><span class="line">		strokeWeight	Number	圆形边线的宽度，以像素为单位</span><br><span class="line">		strokeOpacity	Number	圆形边线透明度，取值范围0 - 1</span><br><span class="line">		fillOpacity	Number	圆形填充的透明度，取值范围0 - 1</span><br><span class="line">		strokeStyle	String	圆形边线的样式，solid或dashed</span><br><span class="line">		enableMassClear	Boolean	是否在调用map.clearOverlays清除此覆盖物，默认为true</span><br><span class="line">		enableEditing	Boolean	是否启用线编辑，默认为false</span><br><span class="line">		enableClicking	Boolean	是否响应点击事件，默认为true</span><br><span class="line">	 * &#125;</span><br><span class="line">	 * </span><br><span class="line">	 * */</span><br><span class="line">	this.Circle = function(center, radius, opts) &#123;</span><br><span class="line">		return new BMap.Circle(center, radius, opts);</span><br><span class="line">	&#125;</span><br><span class="line">	/**</span><br><span class="line">	 * 创建一个图像标注实例。point参数指定了图像标注所在的地理位置</span><br><span class="line">	 * @point &#123;点位坐标  Point&#125; 以指定的经度和纬度创建一个地理点坐标</span><br><span class="line">	 * @opts &#123;</span><br><span class="line">	 * 	offset	Size	标注的位置偏移值</span><br><span class="line">		icon	Icon	标注所用的图标对象</span><br><span class="line">		enableMassClear	Boolean	是否在调用map.clearOverlays清除此覆盖物，默认为true</span><br><span class="line">		enableDragging	Boolean	是否启用拖拽，默认为false</span><br><span class="line">		enableClicking	Boolean	是否响应点击事件。默认为true</span><br><span class="line">		raiseOnDrag	Boolean	拖拽标注时，标注是否开启离开地图表面效果。默认为false</span><br><span class="line">		draggingCursor	String	拖拽标注时的鼠标指针样式。此属性值需遵循CSS的cursor属性规范</span><br><span class="line">		rotation	Number	旋转角度</span><br><span class="line">		shadow	Icon	阴影图标</span><br><span class="line">		title	String	鼠标移到marker上的显示内容</span><br><span class="line">	 * &#125;</span><br><span class="line">	 * */</span><br><span class="line">	this.Marker = function(point, opts) &#123;</span><br><span class="line">		return new BMap.Marker(point, opts);</span><br><span class="line">	&#125;</span><br><span class="line">	/**</span><br><span class="line">	 * 创建折线覆盖物对象</span><br><span class="line">	 * @points &#123;Array&lt;Point&gt;&#125; 点位数组</span><br><span class="line">	 * @opts &#123;</span><br><span class="line">	 * 	strokeColor	String	折线颜色</span><br><span class="line">		strokeWeight	Number	折线的宽度，以像素为单位</span><br><span class="line">		strokeOpacity	Number	折线的透明度，取值范围0 - 1</span><br><span class="line">		strokeStyle	String	折线的样式，solid或dashed</span><br><span class="line">		enableMassClear	Boolean	是否在调用map.clearOverlays清除此覆盖物，默认为true</span><br><span class="line">		enableEditing	Boolean	是否启用线编辑，默认为false</span><br><span class="line">		enableClicking	Boolean	是否响应点击事件，默认为true</span><br><span class="line">		icons	Array&lt;IconSequence&gt;	配置贴合折线的图标</span><br><span class="line">	 * &#125;</span><br><span class="line">	 * */</span><br><span class="line">	this.Polyline = function(points, opts) &#123;</span><br><span class="line">		return new BMap.Polyline(points, opts);</span><br><span class="line">	&#125;</span><br><span class="line">	/**</span><br><span class="line">	 * 以给定的图像地址和大小创建图标对象实例</span><br><span class="line">	 * @url &#123;String&#125; url地址</span><br><span class="line">	 * @size &#123;Size&#125; 大小</span><br><span class="line">	 * @opts &#123;</span><br><span class="line">	 * 	anchor	Size	图标的定位锚点。此点用来决定图标与地理位置的关系，是相对于图标左上角的偏移值，默认等于图标宽度和高度的中间值</span><br><span class="line">		imageOffset	Size	图片相对于可视区域的偏移值</span><br><span class="line">		infoWindowAnchor	Size	信息窗口定位锚点。开启信息窗口时，信息窗口底部尖角相对于图标左上角的位置，默认等于图标的anchor</span><br><span class="line">		printImageUrl	String	用于打印的图片，此属性只适用于IE6，为了解决IE6在包含滤镜的情况下打印样式不正确的问题</span><br><span class="line">	 * &#125;</span><br><span class="line">	 * */</span><br><span class="line">	this.Icon = function(url, size, opts) &#123;</span><br><span class="line">		return new BMap.Icon(url, size, opts);</span><br><span class="line">	&#125;</span><br><span class="line">	/**</span><br><span class="line">	 * 以指定的宽度和高度创建一个矩形区域大小对象</span><br><span class="line">	 * @width &#123;Number&#125; 水平方向的数值</span><br><span class="line">	 * @height &#123;Number&#125; 竖直方向的数值</span><br><span class="line">	 * */</span><br><span class="line">	this.Size = function(width, height) &#123;</span><br><span class="line">		return new BMap.Size(width, height)</span><br><span class="line">	&#125;</span><br><span class="line">	/**</span><br><span class="line">	 * Autocomplete是结果提示、自动完成类。</span><br><span class="line">	 * @options &#123;</span><br><span class="line">	 * 	location	String | Map | Point	设定返回结果的所属范围。例如“北京市”</span><br><span class="line">		types	Array&lt;String&gt;	返回数据类型。两种设置方式，第一种为默认值（即设置值为空），将返回所有数据。如地图初始化为北京，在输入框中输入“小”，输入框下会出现包含“小”关键字的多种类型（如餐饮、地名等）的提示词条。第二种设置值为&quot;city&quot;，将返回省市区县乡镇街道地址类型数据。如地图初始化为北京，在输入框中输入“小”，输入框下会出现“小金县”的地点名称类的提示词条</span><br><span class="line">		onSearchComplete	Function	在input框中输入字符后，发起列表检索，完成后的回调函数。 参数：AutocompleteResult</span><br><span class="line">		input	String | HTMLElement	文本输入框元素或其id</span><br><span class="line">	 * &#125;</span><br><span class="line">	 * */</span><br><span class="line">	this.Autocomplete = function(options) &#123;</span><br><span class="line">		return new BMap.Autocomplete(options);</span><br><span class="line">	&#125;</span><br><span class="line">	/**</span><br><span class="line">	 * 用于位置检索、周边检索和范围检索。</span><br><span class="line">	 * @location &#123;Map | Point | String&#125;</span><br><span class="line">	 * @opts &#123;</span><br><span class="line">	 * 	renderOptions	LocalRenderOptions	结果呈现设置</span><br><span class="line">		onMarkersSet	Function	标注添加完成后的回调函数。 参数： pois: Array，通过marker属性可得到其对应的标注</span><br><span class="line">		onInfoHtmlSet	Function	标注气泡内容创建后的回调函数。 参数： poi: LocalResultPoi，通过其marker属性可得到当前的标注。 html: HTMLElement，气泡内的Dom元素</span><br><span class="line">		onResultsHtmlSet	Function	结果列表添加完成后的回调函数。 参数： container: HTMLElement，结果列表所用的HTML元素</span><br><span class="line">		pageCapacity	Number	设置每页容量，取值范围：1 - 100，对于多关键字检索，容量表示每个关键字的数量，如果有2个关键字，则实际检索结果数量范围为：2 - 200</span><br><span class="line">		onSearchComplete	Function	检索完成后的回调函数。 参数：results: LocalResult或Array 如果是多关键字检索，回调函数参数返回一个LocalResult的数组，数组中的结果顺序和检索中多关键字数组中顺序一致</span><br><span class="line"></span><br><span class="line">	 * &#125;</span><br><span class="line">	 * */</span><br><span class="line">	this.LocalSearch = function(location, opts) &#123;</span><br><span class="line">		return new BMap.LocalSearch(location, opts);</span><br><span class="line">	&#125;</span><br><span class="line">	/**</span><br><span class="line">	 * 创建一个地址解析器的实例</span><br><span class="line">	 * </span><br><span class="line">	 * */</span><br><span class="line">	this.Geocoder = function() &#123;</span><br><span class="line">		return new BMap.Geocoder();</span><br><span class="line">	&#125;</span><br><span class="line">	/**</span><br><span class="line">	 * 创建Geolocation对象实例</span><br><span class="line">	 * </span><br><span class="line">	 * */</span><br><span class="line">	this.Geolocation = function() &#123;</span><br><span class="line">		return new BMap.Geolocation();</span><br><span class="line">	&#125;</span><br><span class="line">	/**</span><br><span class="line">	 * 此类表示地图上包含信息的窗口。</span><br><span class="line">	 * </span><br><span class="line">	 * @content &#123;string | HTMLElement&#125; 创建一个信息窗实例，其中content支持HTML内容。1.2版本开始content参数支持传入DOM结点</span><br><span class="line">	 * @opts </span><br><span class="line">	   &#123;  </span><br><span class="line">	 	width	Number	信息窗宽度，单位像素。取值范围：0, 220 - 730。如果您指定宽度为0，则信息窗口的宽度将按照其内容自动调整</span><br><span class="line">		height	Number	信息窗高度，单位像素。取值范围：0, 60 - 650。如果您指定高度为0，则信息窗口的高度将按照其内容自动调整</span><br><span class="line">		maxWidth	Number	信息窗最大化时的宽度，单位像素。取值范围：220 - 730</span><br><span class="line">		offset	Size	信息窗位置偏移值。默认情况下在地图上打开的信息窗底端的尖角将指向其地理坐标，在标注上打开的信息窗底端尖角的位置取决于标注所用图标的infoWindowOffset属性值，您可以为信息窗添加偏移量来改变默认位置</span><br><span class="line">		title	String	信息窗标题文字，支持HTML内容</span><br><span class="line">		enableAutoPan	Boolean	是否开启信息窗口打开时地图自动移动（默认开启）</span><br><span class="line">		enableCloseOnClick	Boolean	是否开启点击地图关闭信息窗口（默认开启）</span><br><span class="line">		enableMessage	Boolean	是否在信息窗里显示短信发送按钮（默认开启）</span><br><span class="line">		message	String	自定义部分的短信内容，可选项。完整的短信内容包括：自定义部分+位置链接，不设置时，显示默认短信内容。短信内容最长为140个字</span><br><span class="line">	 &#125;</span><br><span class="line">	 * */</span><br><span class="line">	this.InfoWindow = function(content, opts) &#123;</span><br><span class="line">		return new BMap.InfoWindow(content, opts)</span><br><span class="line">	&#125;</span><br><span class="line">	/**</span><br><span class="line">	 * 创建一个文本标注实例。point参数指定了文本标注所在的地理位置</span><br><span class="line">	 * @content &#123;String&#125;  标题内容</span><br><span class="line">	 * @opts &#123;</span><br><span class="line">	 * 	offset	Size	文本标注的位置偏移值</span><br><span class="line">		position	Point	文本标注的地理位置</span><br><span class="line">		enableMassClear	Boolean	是否在调用map.clearOverlays清除此覆盖物，默认为true</span><br><span class="line"></span><br><span class="line">	 * &#125;</span><br><span class="line">	 * */</span><br><span class="line">	this.Label = function(content, opts) &#123;</span><br><span class="line">		return new BMap.Label(content, opts);</span><br><span class="line">	&#125;</span><br><span class="line">	/**</span><br><span class="line">	 * 打开window 窗体</span><br><span class="line">	 * @infoWindow 实例化的 InfoWindow窗体</span><br><span class="line">	 * @point &#123;点位坐标  Point&#125; 以指定的经度和纬度创建一个地理点坐标</span><br><span class="line">	 * */</span><br><span class="line">	this.openInfoWindow = function(infoWindow, point) &#123;</span><br><span class="line">		this.pulic.openInfoWindow(infoWindow, point);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;, function() &#123;</span><br><span class="line">	&apos;use strict&apos;;</span><br><span class="line">	//高德地图相关方法封装</span><br><span class="line">	if(!AMap) &#123;</span><br><span class="line">		console.error(&apos;请检查config配置项与加载的地图js是否正确!&apos;);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	//验证数据类型</span><br><span class="line">	var _toString = Object.prototype.toString;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 在指定的容器内创建地图实例，之后需要调用Map.centerAndZoom()方法对地图进行初始化。未进行初始化的地图将不能进行任何操作</span><br><span class="line">	 * @container &#123;String | HTMLElement&#125; </span><br><span class="line">	 * @opt &#123;</span><br><span class="line">	 * </span><br><span class="line">	 * //百度提供的参数</span><br><span class="line">	 * 	属性	              类型	                                   描述</span><br><span class="line">		minZoom	Number	地图允许展示的最小级别</span><br><span class="line">		maxZoom	Number	地图允许展示的最大级别</span><br><span class="line">		mapType	MapType	地图类型，默认为BMAP_NORMAL_MAP</span><br><span class="line">		enableHighResolution	Boolean	是否启用使用高分辨率地图。在iPhone4及其后续设备上，可以通过开启此选项获取更高分辨率的底图，v1.2,v1.3版本默认不开启，v1.4默认为开启状态</span><br><span class="line">		enableAutoResize	Boolean	是否自动适应地图容器变化，默认启用</span><br><span class="line">		enableMapClick	Boolean	是否开启底图可点功能，默认启用</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		//高德提供的参数</span><br><span class="line">		view    View2D  地图视口，用于控制影响地图静态显示的属性，如：地图中心点“center” 推荐直接使用zoom、center属性为地图指定级别和中心点 （自v1.3 新增）</span><br><span class="line">        layers  Array   地图图层数组，数组可以是图层 中的一个或多个，默认为普通二维地图。当叠加多个图层时，普通二维地图需通过实例化一个TileLayer类实现（自v1.3 新增）</span><br><span class="line">        zoom    Number  地图显示的缩放级别，若center与level未赋值，地图初始化默认显示用户所在城市范围3D地图下，zoom值，可以设置为浮点数。（在V1.3.0版本level参数调整为zoom，3D地图修改自V1.4.0开始生效）</span><br><span class="line">        center  LngLat  地图中心点坐标值 </span><br><span class="line">        labelzIndex   Number   地图标注显示顺序，大于110即可将底图上的默认标注显示在覆盖物（圆、折线、面）之上。</span><br><span class="line">        zooms   Array   地图显示的缩放级别范围在PC上，默认为[3,18]，取值范围[3-18]；在移动设备上，默认为[3,19],取值范围[3-19]</span><br><span class="line">        lang    String  地图语言类型可选值：zh_cn：中文简体，en：英文，zh_en：中英文对照默认为: zh_cn：中文简体注：由于图面内容限制，中文、英文 、中英文地图POI可能存在不一致的情况（自v1.3 新增）</span><br><span class="line">        defaultCursor   String   地图默认鼠标样式。参数defaultCursor应符合CSS的cursor属性规范</span><br><span class="line">        crs   String    地图显示的参考坐标系，取值：&apos;EPSG3857&apos;&apos;EPSG3395&apos;&apos;EPSG4326&apos;自V1.3.0移入view对象中</span><br><span class="line">        animateEnable   Boolean  地图平移过程中是否使用动画（如调用panBy、panTo、setCenter、setZoomAndCenter等函数，将对地图产生平移操作，是否使用动画平移的效果），默认为true，即使用动画</span><br><span class="line">        isHotspot  Boolean  是否开启地图热点，默认false 不打开（自v1.3 新增）</span><br><span class="line">        defaultLayer   TileLayer   当前地图中默认显示的图层。默认图层可以是TileLayer.Satellite等切片地图，也可以是通过TileLayer自定义的切片图层（自v1.3 废弃）</span><br><span class="line">        rotateEnable   Boolean   地图是否可旋转，默认false。3D视图默认为true，2D视图默认false。（V1.3版本新增，3D视图自V1.4.0开始支持）</span><br><span class="line">        resizeEnable   Boolean   是否监控地图容器尺寸变化，默认值为false</span><br><span class="line">        showIndoorMap  Boolean   是否在有矢量底图的时候自动展示室内地图，PC端默认是true，移动端默认是false</span><br><span class="line">        indoorMap      IndoorMap   在展示矢量图的时候自动展示室内地图图层，当地图complete之后可以获取到该对象</span><br><span class="line">        expandZoomRange   Boolean  是否支持可以扩展最大缩放级别,和zooms属性配合使用 设置为true的时候，zooms的最大级别在PC上可以扩大到20级，移动端还是高清19/非高清20</span><br><span class="line">        dragEnable   Boolean  地图是否可通过鼠标拖拽平移，默认为true。此属性可被setStatus/getStatus 方法控制</span><br><span class="line">        zoomEnable   Boolean  地图是否可缩放，默认值为true。此属性可被setStatus/getStatus 方法控制</span><br><span class="line">        doubleClickZoom   Boolean  地图是否可通过双击鼠标放大地图，默认为true。此属性可被setStatus/getStatus 方法控制</span><br><span class="line">        keyboardEnable  Boolean  地图是否可通过键盘控制,默认为true 方向键控制地图平移，&quot;+&quot;和&quot;-&quot;可以控制地图的缩放， Ctrl+“→”顺时针旋转，Ctrl+“←”逆时针旋转。此属性可被setStatus/getStatus 方法控制</span><br><span class="line">        jogEnable   Boolean   地图是否使用缓动效果，默认值为true。此属性可被setStatus/getStatus 方法控制</span><br><span class="line">        scrollWheel  Boolean  地图是否可通过鼠标滚轮缩放浏览，默认为true。此属性可被setStatus/getStatus 方法控制</span><br><span class="line">        touchZoom   Boolean   地图在移动终端上是否可通过多点触控缩放浏览地图，默认为true。关闭手势缩放地图，请设置为false。</span><br><span class="line">        touchZoomCenter  Number  可缺省，当touchZoomCenter=1的时候，手机端双指缩放的以地图中心为中心，否则默认以双指中间点为中心</span><br><span class="line">        mapStyle   String   设置地图的显示样式，目前支持两种地图样式： 第一种：自定义地图样式，如&quot;amap://styles/d6bf8c1d69cea9f5c696185ad4ac4c86&quot;可前往地图自定义平台定制自己的个性地图样式；第二种：官方样式模版,如&quot;amap://styles/grey&quot;。其他模版样式及自定义地图的使用说明见开发指南</span><br><span class="line">        features   Array   设置地图上显示的元素种类 支持&apos;bg&apos;（地图背景）、&apos;point&apos;（POI点）、&apos;road&apos;（道路）、&apos;building&apos;（建筑物）</span><br><span class="line">        showBuildingBlock  Boolean  设置地图显示3D楼块效果，移动端也可使用。推荐使用。</span><br><span class="line">        viewMode  String  默认为‘2D’，可选’3D’，选择‘3D’会显示 3D 地图效果。（自V1.4.0开始支持）</span><br><span class="line">        pitch  Number  俯仰角度，默认0，[0,83]，2D地图下无效 。（自V1.4.0开始支持）</span><br><span class="line">        pitchEnable  Boolean  是否允许设置俯仰角度，3D视图下为true，2D视图下无效。（自V1.4.0开始支持）</span><br><span class="line">        buildingAnimation  Boolean  楼块出现和消失的时候是否显示动画过程，3D视图有效，PC端默认true，手机端默认false。（自V1.4.0开始支持）</span><br><span class="line">        skyColor  String  调整天空颜色，配合自定义地图，3D视图有效，如‘#ff0000’。（自V1.4.0开始支持）	</span><br><span class="line">	 * &#125; 此类表示Map构造函数的可选参数。它没有构造函数，但可通过对象字面量形式表示。</span><br><span class="line">	 * */</span><br><span class="line">	this.Map = function(container, opt) &#123;</span><br><span class="line">		var that = this.pulic = new AMap.Map(container, opt);</span><br><span class="line">		//触发实例方法进行重写</span><br><span class="line">		this.setpulic(1);</span><br><span class="line">		return that;</span><br><span class="line">	&#125;;</span><br><span class="line">	/**</span><br><span class="line">	 * 创建maker覆盖物</span><br><span class="line">	 * @point &#123;点位坐标  Point&#125; 以指定的经度和纬度创建一个地理点坐标</span><br><span class="line">	 * @opts &#123;</span><br><span class="line">	 *  //百度参数</span><br><span class="line">	 * 	offset	Size	标注的位置偏移值</span><br><span class="line">		icon	Icon	标注所用的图标对象</span><br><span class="line">		enableMassClear	Boolean	是否在调用map.clearOverlays清除此覆盖物，默认为true</span><br><span class="line">		enableDragging	Boolean	是否启用拖拽，默认为false</span><br><span class="line">		enableClicking	Boolean	是否响应点击事件。默认为true</span><br><span class="line">		raiseOnDrag	Boolean	拖拽标注时，标注是否开启离开地图表面效果。默认为false</span><br><span class="line">		draggingCursor	String	拖拽标注时的鼠标指针样式。此属性值需遵循CSS的cursor属性规范</span><br><span class="line">		rotation	Number	旋转角度</span><br><span class="line">		shadow	Icon	阴影图标</span><br><span class="line">		title	String	鼠标移到marker上的显示内容</span><br><span class="line">		</span><br><span class="line">		//高德参数</span><br><span class="line">		map	Map	要显示该marker的地图对象</span><br><span class="line">		position	LngLat	点标记在地图上显示的位置，默认为地图中心点</span><br><span class="line">		offset	Pixel	点标记显示位置偏移量，默认值为Pixel(-10,-34)。Marker指定position后，默认以marker左上角位置为基准点，对准所给定的position位置，若需使marker指定位置对准在position处，需根据marker的尺寸设置一定的偏移量。</span><br><span class="line">		icon	String/Icon	需在点标记中显示的图标。可以是一个本地图标地址，或者Icon对象。有合法的content内容时，此属性无效</span><br><span class="line">		content	String/Object	点标记显示内容，可以是HTML要素字符串或者HTML DOM对象。content有效时，icon属性将被覆盖</span><br><span class="line">		topWhenClick	Boolean	鼠标点击时marker是否置顶，默认false ，不置顶 （自v1.3 新增）</span><br><span class="line">		bubble	Boolean	是否将覆盖物的鼠标或touch等事件冒泡到地图上 （自v1.3 新增）</span><br><span class="line">		默认值：false</span><br><span class="line">		draggable	Boolean	设置点标记是否可拖拽移动，默认为false</span><br><span class="line">		raiseOnDrag	Boolean	设置拖拽点标记时是否开启点标记离开地图的效果</span><br><span class="line">		cursor	String	指定鼠标悬停时的鼠标样式，自定义cursor，IE仅支持cur/ani/ico格式，Opera不支持自定义cursor</span><br><span class="line">		visible	Boolean	点标记是否可见，默认为true</span><br><span class="line">		zIndex	Number	点标记的叠加顺序。地图上存在多个点标记叠加时，通过该属性使级别较高的点标记在上层显示</span><br><span class="line">		默认zIndex：100</span><br><span class="line">		angle	Number	点标记的旋转角度，广泛用于改变车辆行驶方向</span><br><span class="line">		注：angle属性是使用CSS3来实现的，支持IE9及以上版本</span><br><span class="line">		autoRotation	Boolean	是否自动旋转。点标记在使用moveAlong动画时，路径方向若有变化，点标记是否自动调整角度，默认为false。广泛用于自动调节车辆行驶方向。</span><br><span class="line">		IE8以下不支持旋转，autoRotation属性无效</span><br><span class="line">		animation	String	点标记的动画效果，默认值：</span><br><span class="line">		“AMAP_ANIMATION_NONE” </span><br><span class="line">		可选值： </span><br><span class="line">		“AMAP_ANIMATION_NONE”，无动画效果 </span><br><span class="line">		“AMAP_ANIMATION_DROP”，点标掉落效果 </span><br><span class="line">		“AMAP_ANIMATION_BOUNCE”，点标弹跳效果 </span><br><span class="line">		shadow	Icon	点标记阴影，不设置该属性则点标记无阴影</span><br><span class="line">		title	String	鼠标滑过点标记时的文字提示，不设置则鼠标滑过点标无文字提示</span><br><span class="line">		clickable	Boolean	点标记是否可点击</span><br><span class="line">		shape	MarkerShape	设置Marker的可点击区域，在定义的区域内可触发Marker的鼠标点击事件</span><br><span class="line">		extData	Any	用户自定义属性，支持JavaScript API任意数据类型，如Marker的id等</span><br><span class="line">		label	&#123;content,offset&#125;	添加文本标注，content为文本标注的内容，offset为偏移量，左上角为偏移量为（0,0）</span><br><span class="line">	 * &#125;</span><br><span class="line">	 * */</span><br><span class="line">	this.Marker = function(point, opts) &#123;</span><br><span class="line">		opts = opts || &#123;&#125;;</span><br><span class="line">		//opts.map=this.pulic;</span><br><span class="line">		opts.position = point;</span><br><span class="line">		AMap.Marker.prototype.addEventListener = AMap.Marker.prototype.on;</span><br><span class="line">		return new AMap.Marker(opts);</span><br><span class="line">	&#125;</span><br><span class="line">	/**</span><br><span class="line">	 * //百度的参数</span><br><span class="line">	 * @url &#123;String&#125; url地址</span><br><span class="line">	 * @size &#123;Size&#125; 大小</span><br><span class="line">	 * @opts &#123;</span><br><span class="line">	 * 	anchor	Size	图标的定位锚点。此点用来决定图标与地理位置的关系，是相对于图标左上角的偏移值，默认等于图标宽度和高度的中间值</span><br><span class="line">		imageOffset	Size	图片相对于可视区域的偏移值</span><br><span class="line">		infoWindowAnchor	Size	信息窗口定位锚点。开启信息窗口时，信息窗口底部尖角相对于图标左上角的位置，默认等于图标的anchor</span><br><span class="line">		printImageUrl	String	用于打印的图片，此属性只适用于IE6，为了解决IE6在包含滤镜的情况下打印样式不正确的问题</span><br><span class="line">	 * &#125;</span><br><span class="line">	 * </span><br><span class="line">	 * //高德参数</span><br><span class="line">	 * size	Size	图标尺寸，默认值(36,36)</span><br><span class="line">	   imageOffset	Pixel	图标取图偏移量。当image中指定了一个大图时，可通过size和imageOffset配合，显示图标的指定范围</span><br><span class="line">	   image	String	图标的取图地址。默认为蓝色图钉图片</span><br><span class="line">	   imageSize	Size	图标所用图片大小，根据所设置的大小拉伸或压缩图片，等同于CSS中的background-size属性。可用于实现高清屏的高清效果</span><br><span class="line">	 * */</span><br><span class="line">	this.Icon = function(url, size, opts) &#123;</span><br><span class="line">		opts = opts || &#123;&#125;;</span><br><span class="line">		url ? opts.image = url : &quot;&quot;;</span><br><span class="line">		opts.size = size;</span><br><span class="line">		return new AMap.Icon(opts);</span><br><span class="line">	&#125;</span><br><span class="line">	/**</span><br><span class="line">	 * 以指定的宽度和高度创建一个矩形区域大小对象</span><br><span class="line">	 * @width &#123;Number&#125; 水平方向的数值</span><br><span class="line">	 * @height &#123;Number&#125; 竖直方向的数值</span><br><span class="line">	 * */</span><br><span class="line">	this.Size = function(width, height) &#123;</span><br><span class="line">		return new AMap.Size(width, height);</span><br><span class="line">	&#125;</span><br><span class="line">	/**</span><br><span class="line">	 * 创建点位</span><br><span class="line">	 * @lng &#123;Number&#125;  地理经度</span><br><span class="line">	 * @lat &#123;Number&#125;  地理纬度</span><br><span class="line">	 * */</span><br><span class="line">	this.Point = function(lng, lat) &#123;</span><br><span class="line">		return new AMap.LngLat(lng, lat);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 创建一个地址解析器的实例</span><br><span class="line">	 * */</span><br><span class="line">	this.Geocoder = function() &#123;</span><br><span class="line">		if(!AMap.Geocoder) &#123;</span><br><span class="line">			console.error(&apos;使用高德地图Geocoder需要加载插件支持&apos;);</span><br><span class="line">			return;</span><br><span class="line">		&#125;</span><br><span class="line">		return new AMap.Geocoder(&#123; lang: &apos;zh_cn&apos; &#125;)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * @content &#123;string | HTMLElement&#125; 创建一个信息窗实例，其中content支持HTML内容。1.2版本开始content参数支持传入DOM结点</span><br><span class="line">	 * @opts</span><br><span class="line">	 &#123;</span><br><span class="line">	 	isCustom  Boolean  是否自定义窗体。设为true时，信息窗体外框及内容完全按照content所设的值添加（默认为false，即在系统默认的信息窗体外框中显示content内容）</span><br><span class="line">        autoMove  Boolean  是否自动调整窗体到视野内（当信息窗体超出视野范围时，通过该属性设置是否自动平移地图，使信息窗体完全显示）</span><br><span class="line">        closeWhenClickMap  Boolean  控制是否在鼠标点击地图后关闭信息窗体，默认false，鼠标点击地图后不关闭信息窗体</span><br><span class="line">        content  String/HTMLElement  显示内容，可以是HTML要素字符串或者HTMLElement对象，自定义窗体示例</span><br><span class="line">        size  Size  信息窗体尺寸（isCustom为true时，该属性无效）</span><br><span class="line">        offset  Pixel  相对于基点的偏移量。默认情况是信息窗体的底部中心点(BOTTOM_CENTER) 和基点之间的偏移量</span><br><span class="line">        position  LngLat  信息窗体显示基点位置 （自v1.2 新增）</span><br><span class="line">        showShadow  Boolean  Boolean 控制是否显示信息窗体阴影，取值false时不显示窗体阴影，取值true时显示窗体阴影 默认值：false</span><br><span class="line">	 &#125;</span><br><span class="line">	 * */</span><br><span class="line">	this.InfoWindow = function(content, opts) &#123;</span><br><span class="line">		opts = opts || &#123;&#125;;</span><br><span class="line">		opts.content = content;</span><br><span class="line">		opts.isCustom = false;</span><br><span class="line">		opts.size = this.Size(opts.width, opts.height);</span><br><span class="line">		opts.showShadow = false;</span><br><span class="line">		return new AMap.InfoWindow(opts)</span><br><span class="line">	&#125;</span><br><span class="line">	/**</span><br><span class="line">	 * 使用</span><br><span class="line">	 * @infoWindow 实例化的 InfoWindow窗体</span><br><span class="line">	 * @point &#123;点位坐标  Point&#125; 以指定的经度和纬度创建一个地理点坐标</span><br><span class="line">	 * */</span><br><span class="line">	this.openInfoWindow = function(infoWindow, point) &#123;</span><br><span class="line">		infoWindow.open(this.pulic, point);</span><br><span class="line">	&#125;</span><br><span class="line">	/**</span><br><span class="line">	 * 创建圆覆盖物</span><br><span class="line">	 * @center &#123;Point&#125; 圆心</span><br><span class="line">	 * @radius &#123;Number&#125; 半径米</span><br><span class="line">	 * @opts &#123;</span><br><span class="line">	 	* //百度接收的参数</span><br><span class="line">	 * 	    strokeColor	String	圆形边线颜色</span><br><span class="line">			fillColor	String	圆形填充颜色。当参数为空时，圆形将没有填充效果</span><br><span class="line">			strokeWeight	Number	圆形边线的宽度，以像素为单位</span><br><span class="line">			strokeOpacity	Number	圆形边线透明度，取值范围0 - 1</span><br><span class="line">			fillOpacity	Number	圆形填充的透明度，取值范围0 - 1</span><br><span class="line">			strokeStyle	String	圆形边线的样式，solid或dashed</span><br><span class="line">			enableMassClear	Boolean	是否在调用map.clearOverlays清除此覆盖物，默认为true</span><br><span class="line">			enableEditing	Boolean	是否启用线编辑，默认为false</span><br><span class="line">			enableClicking	Boolean	是否响应点击事件，默认为true</span><br><span class="line">			</span><br><span class="line">			//高德地图</span><br><span class="line">			</span><br><span class="line">			map	Map	要显示该circle的地图对象 （自v1.2 新增）</span><br><span class="line">			zIndex	Number	层叠顺序</span><br><span class="line">			默认zIndex:10</span><br><span class="line">			center	LngLat	圆心位置</span><br><span class="line">			bubble	Boolean	是否将覆盖物的鼠标或touch等事件冒泡到地图上 （自v1.3 新增）默认值：false</span><br><span class="line">			cursor	String	指定鼠标悬停时的鼠标样式，自定义cursor，IE仅支持cur/ani/ico格式，Opera不支持自定义cursor</span><br><span class="line">			radius	Number	圆半径，单位:米</span><br><span class="line">			strokeColor	String	线条颜色，使用16进制颜色代码赋值。默认值为#006600</span><br><span class="line">			strokeOpacity	Float	轮廓线透明度，取值范围[0,1]，0表示完全透明，1表示不透明。默认为0.9</span><br><span class="line">			strokeWeight	Number	轮廓线宽度</span><br><span class="line">			fillColor	String	圆形填充颜色,使用16进制颜色代码赋值。默认值为#006600</span><br><span class="line">			fillOpacity	Float	圆形填充透明度，取值范围[0,1]，0表示完全透明，1表示不透明。默认为0.9</span><br><span class="line">			strokeStyle	String	轮廓线样式，实线:solid，虚线:dashed</span><br><span class="line">			extData	Any	用户自定义属性，支持JavaScript API任意数据类型，如Circle的id等</span><br><span class="line">			strokeDasharray	Array	勾勒形状轮廓的虚线和间隙的样式，此属性在strokeStyle 为dashed 时有效， 此属性在ie9+浏览器有效 取值： 实线：[0,0,0] 虚线：[10,10] ，[10,10] 表示10 个像素的实线和10 个像素的空白（如此反复）组成的虚线点画线：[10,2,10]， [10,2,10] 表示10 个像素的实线和2 个像素的空白 + 10 个像素的实线和10 个像素的空白 （如此反复）组成的虚线</span><br><span class="line">	 * &#125;</span><br><span class="line">	 * */</span><br><span class="line">	this.Circle = function(center, radius, opts) &#123;</span><br><span class="line">		opts = opts || &#123;&#125;;</span><br><span class="line">		opts.center = center;</span><br><span class="line">		opts.radius = radius;</span><br><span class="line">		return new AMap.Circle(opts);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 创建折线覆盖物对象</span><br><span class="line">	 * @points &#123;Array&lt;Point&gt;&#125;</span><br><span class="line">	 * @opts &#123;</span><br><span class="line">	 	//百度参数</span><br><span class="line">	   	strokeColor	String	折线颜色</span><br><span class="line">		strokeWeight	Number	折线的宽度，以像素为单位</span><br><span class="line">		strokeOpacity	Number	折线的透明度，取值范围0 - 1</span><br><span class="line">		strokeStyle	String	折线的样式，solid或dashed</span><br><span class="line">		enableMassClear	Boolean	是否在调用map.clearOverlays清除此覆盖物，默认为true</span><br><span class="line">		enableEditing	Boolean	是否启用线编辑，默认为false</span><br><span class="line">		enableClicking	Boolean	是否响应点击事件，默认为true</span><br><span class="line">		icons	Array&lt;IconSequence&gt;	配置贴合折线的图标</span><br><span class="line">		</span><br><span class="line">		//高德参数</span><br><span class="line">		map	Map	要显示该polyline的地图对象</span><br><span class="line">		zIndex	Number	折线覆盖物的叠加顺序。默认叠加顺序，先添加的线在底层，后添加的线在上层。通过该属性可调整叠加顺序，使级别较高的折线覆盖物在上层显示默认zIndex：50</span><br><span class="line">		bubble	Boolean	是否将覆盖物的鼠标或touch等事件冒泡到地图上 （自v1.3 新增）默认值：false</span><br><span class="line">		cursor	String	指定鼠标悬停时的鼠标样式，自定义cursor，IE仅支持cur/ani/ico格式，Opera不支持自定义cursor</span><br><span class="line">		geodesic	Boolean	是否绘制成大地线，默认false相关示例</span><br><span class="line">		isOutline	Boolean	线条是否带描边，默认false</span><br><span class="line">		borderWeight	Number	描边的宽度，默认为1</span><br><span class="line">		outlineColor	String	线条描边颜色，此项仅在isOutline为true时有效，默认：#000000</span><br><span class="line">		path	Array	折线的节点坐标数组</span><br><span class="line">		strokeColor	String	线条颜色，使用16进制颜色代码赋值。默认值为#006600</span><br><span class="line">		strokeOpacity	Number	线条透明度，取值范围[0,1]，0表示完全透明，1表示不透明。默认为0.9</span><br><span class="line">		strokeWeight	Number	线条宽度，单位：像素</span><br><span class="line">		strokeStyle	String	线样式，实线:solid，虚线:dashed</span><br><span class="line">		strokeDasharray	Array	勾勒形状轮廓的虚线和间隙的样式，此属性在strokeStyle 为dashed 时有效， 此属性在ie9+浏览器有效 取值： 实线：[0,0,0] 虚线：[10,10] ，[10,10] 表示10个像素的实线和10个像素的空白（如此反复）组成的虚线点画线：[10,2,10]， [10,2,10] 表示10个像素的实线和2个像素的空白 + 10个像素的实线和10个像素的空白 （如此反复）组成的虚线</span><br><span class="line">		lineJoin	String	折线拐点的绘制样式，默认值为&apos;miter&apos;尖角，其他可选值：&apos;round&apos;圆角、&apos;bevel&apos;斜角</span><br><span class="line">		lineCap	String	折线两端线帽的绘制样式，默认值为&apos;butt&apos;无头，其他可选值：&apos;round&apos;圆头、&apos;square&apos;方头</span><br><span class="line">		draggable	Boolean	设置折线是否可拖拽移动，默认为false</span><br><span class="line">		extData	Any	用户自定义属性，支持JavaScript API任意数据类型，如Polyline的id等</span><br><span class="line">		showDir	Boolean	是否延路径显示白色方向箭头,默认false。Canvas绘制时有效，建议折线宽度大于6时使用；在3D视图下不支持显示方向箭头（自V1.4.0版本参数效果变更）</span><br><span class="line">	 * &#125;</span><br><span class="line">	 * */</span><br><span class="line">	this.Polyline = function(points, opts) &#123;</span><br><span class="line">		opts = opts || &#123;&#125;;</span><br><span class="line">		if(_toString.call(points) === &quot;[object Array]&quot;) &#123;</span><br><span class="line">			for(var i = 0; i &lt; points.length; i++) &#123;</span><br><span class="line"></span><br><span class="line">				if(_toString.call(points[i]) === &quot;[object Object]&quot;) &#123;</span><br><span class="line">					points[i] = [points[i].lng, points[i].lat];</span><br><span class="line"></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		if(_toString.call(points) === &quot;[object Object]&quot;) &#123;</span><br><span class="line">			var ns = [points.lng, points.lat];</span><br><span class="line">			points = ns;</span><br><span class="line">		&#125;</span><br><span class="line">		if(ns) &#123;</span><br><span class="line">			opts.path = [points];</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			opts.path = points;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		//opts.map=this.pulic;</span><br><span class="line">		return new AMap.Polyline(opts);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 创建一个文本标注实例。point参数指定了文本标注所在的地理位置</span><br><span class="line">	 * @content &#123;String&#125;  标题内容</span><br><span class="line">	 * @opts &#123;</span><br><span class="line">	    //百度参数</span><br><span class="line">	 * 	offset	Size	文本标注的位置偏移值</span><br><span class="line">		position	Point	文本标注的地理位置</span><br><span class="line">		enableMassClear	Boolean	是否在调用map.clearOverlays清除此覆盖物，默认为true</span><br><span class="line">		//高德参数</span><br><span class="line">	 * &#125;</span><br><span class="line">	 * */</span><br><span class="line">	this.Label = function(content, opts) &#123;</span><br><span class="line">		opts = opts || &#123;&#125;;</span><br><span class="line">		//opts.map=this.pulic;</span><br><span class="line">		opts.text = content;</span><br><span class="line">		return new AMap.Text(opts);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 *构造一个像素坐标对象。 </span><br><span class="line">	 * @x&#123;Number&#125; 设置X方向像素坐标</span><br><span class="line">	 * @y&#123;Number&#125; 设置Y方向像素坐标</span><br><span class="line">	 * */</span><br><span class="line">	this.Pixel = function(x, y) &#123;</span><br><span class="line">		return new AMap.Pixel(x, y);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">      * 智能搜索</span><br><span class="line">      * @map &#123;地图&#125; </span><br><span class="line">      * @obts &#123;</span><br><span class="line">      * 	input	&#123;string&#125; 输入设置input</span><br><span class="line">      *     output  &#123;String／HTMLDivElement&#125;  输出设置</span><br><span class="line">			callback Function	搜索结果的回调</span><br><span class="line">      * &#125;</span><br><span class="line">      * */</span><br><span class="line">	this.LocalSearch = function(map, opts) &#123;</span><br><span class="line">		opts = opts || &#123;&#125;;</span><br><span class="line">		var that = opts;</span><br><span class="line">		//建立智能填充</span><br><span class="line">		if(!AMap.Autocomplete) &#123;</span><br><span class="line">			console.error(&apos;使用高德地图LocalSearch需要加载插件支持&apos;);</span><br><span class="line">			return;</span><br><span class="line">		&#125;</span><br><span class="line">		var auto = new AMap.Autocomplete(&#123;</span><br><span class="line">			input: opts.input,</span><br><span class="line">			output: opts.output</span><br><span class="line">		&#125;);</span><br><span class="line">		var placeSearch = new AMap.PlaceSearch(&#123;</span><br><span class="line">			map: map</span><br><span class="line">		&#125;); //构造地点查询类</span><br><span class="line">		AMap.event.addListener(auto, &quot;select&quot;, function(e) &#123;</span><br><span class="line">			if(that &amp;&amp; that.callback) &#123;</span><br><span class="line">				that.callback(e);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;); //注册监听，当选中某条记录时会触发</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 区域搜索</span><br><span class="line">	 * Rectangle</span><br><span class="line">	 * </span><br><span class="line">	 * */</span><br><span class="line">	this.SearchInRectangle = function(d) &#123;</span><br><span class="line"></span><br><span class="line">		var map = this.pulic, //地图实例</span><br><span class="line">			southWest = null, //开始位置</span><br><span class="line">			rectangle = null; //区域搜索</span><br><span class="line">		/**</span><br><span class="line">		 * 解绑事件</span><br><span class="line">		 * */</span><br><span class="line">		!function removeListener() &#123;</span><br><span class="line">            map.off(&apos;mousedown&apos;, mousedownfn);</span><br><span class="line">            map.off(&apos;mousemove&apos;, mousemovefn);</span><br><span class="line">            map.off(&apos;mouseup&apos;, mouseupfn);</span><br><span class="line">            document.removeEventListener(&apos;mouseup&apos;, mouseupfn,false);</span><br><span class="line">        &#125;();</span><br><span class="line">		/**</span><br><span class="line">		 * 鼠标按下事件函数</span><br><span class="line">		 * */</span><br><span class="line">		function mousedownfn(e) &#123;</span><br><span class="line">			//设置鼠标不可以拖拽</span><br><span class="line">			map.setStatus(&#123;</span><br><span class="line">				dragEnable: false //true 可以拖拽</span><br><span class="line">			&#125;);</span><br><span class="line">			southWest = new AMap.LngLat(e.lnglat.lng, e.lnglat.lat);</span><br><span class="line">			//console.log(&apos;鼠标mousedown&apos;,e.lnglat.lng+&apos;||&apos;+e.lnglat.lat );</span><br><span class="line">			rectangle = new AMap.Rectangle(&#123;</span><br><span class="line">				map: map,</span><br><span class="line">				bounds: new AMap.Bounds(southWest, southWest),</span><br><span class="line">				strokeColor: d.strokeColor || &quot;#1791fc&quot;,</span><br><span class="line">				strokeOpacity: d.strokeOpacity || 0.8,</span><br><span class="line">				strokeWeight: d.strokeWeight || 2,</span><br><span class="line">				fillColor: d.fillColor || &quot;#1791fc&quot;,</span><br><span class="line">				fillOpacity: d.fillOpacity || 0.35,</span><br><span class="line">				dragEnable: !1,</span><br><span class="line">				strokeStyle: d.strokeStyle || &quot;solid&quot;,</span><br><span class="line">				strokeDasharray: d.strokeDasharray || [10, 5],</span><br><span class="line">				zIndex: d.zIndex || 10,</span><br><span class="line">				bubble: !0,</span><br><span class="line">				cursor: &apos;pointer&apos;,</span><br><span class="line">			&#125;);</span><br><span class="line">			// console.log(southWest.rectZoomIn,&apos;southWest&apos;);   </span><br><span class="line">		&#125;</span><br><span class="line">		//绑定鼠标移动事件</span><br><span class="line">		map.on(&apos;mousemove&apos;, mousemovefn);</span><br><span class="line">		/**</span><br><span class="line">		 * 鼠标移动事件函数</span><br><span class="line">		 * */</span><br><span class="line">		function mousemovefn(e) &#123;</span><br><span class="line">			//console.log(southWest);</span><br><span class="line">			if(southWest) &#123;</span><br><span class="line">				//console.log(&apos;鼠标mousemove&apos;,e.lnglat.lng+&apos;||&apos;+e.lnglat.lat );</span><br><span class="line">				var northEast = new AMap.LngLat(e.lnglat.lng, e.lnglat.lat); //结束位置</span><br><span class="line">				var Bounds = new AMap.Bounds(southWest, northEast); //矩形范围</span><br><span class="line">				//设置矩形设置矩形的范围</span><br><span class="line">				rectangle &amp;&amp; rectangle.setBounds(Bounds);</span><br><span class="line">			</span><br><span class="line">				if(mouseupfn.isclear) &#123;</span><br><span class="line">					mouseupfn.isclear = 0;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			// console.log(map.getBounds());</span><br><span class="line">		&#125;</span><br><span class="line">		//绑定鼠标弹起事件</span><br><span class="line">		map.on(&apos;mouseup&apos;, mouseupfn);</span><br><span class="line">		/**</span><br><span class="line">		 * 鼠标弹起事件函数</span><br><span class="line">		 * */</span><br><span class="line">		function mouseupfn(e) &#123;</span><br><span class="line">			if(mouseupfn.isclear) &#123;</span><br><span class="line">				return false;</span><br><span class="line">			&#125;</span><br><span class="line">			mouseupfn.isclear = 1;</span><br><span class="line">			//设置鼠标不可以拖拽</span><br><span class="line">			map.setStatus(&#123;</span><br><span class="line">				dragEnable: true //true 可以拖拽</span><br><span class="line">			&#125;);</span><br><span class="line"></span><br><span class="line">			//删除覆盖物</span><br><span class="line">			setTimeout(function() &#123;</span><br><span class="line">				if(rectangle) &#123;</span><br><span class="line">					map.remove(rectangle);</span><br><span class="line">					rectangle = null;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;, 200);</span><br><span class="line"></span><br><span class="line">			southWest = null;</span><br><span class="line">			//执行回调</span><br><span class="line">			if(d.callback) d.callback(rectangle.getBounds());</span><br><span class="line">			//console.log(&apos;鼠标mouseup&apos;,e.lnglat.lng+&apos;||&apos;+e.lnglat.lat );</span><br><span class="line">		&#125;</span><br><span class="line">		//绑定鼠标按下事件</span><br><span class="line">		map.on(&apos;mousedown&apos;, mousedownfn);</span><br><span class="line">		//给document绑定mouseup事件</span><br><span class="line">		document.addEventListener(&apos;mouseup&apos;, mouseupfn, false);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	/**</span><br><span class="line">	 * 坐标转换</span><br><span class="line">	 * 百度to高德</span><br><span class="line">	 * @lnglat&#123;LngLat|Array.&lt;LngLat&gt;&#125; 经纬度</span><br><span class="line">	 * @type &#123;String&#125;  gps:GPS原始坐标；baidu：百度经纬度；mapbar：图吧经纬度；</span><br><span class="line">	 * */</span><br><span class="line">	this.convertFrom = function(lnglat, callback) &#123;</span><br><span class="line"></span><br><span class="line">		AMap.convertFrom(lnglat, &quot;baidu&quot;, callback)</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;]);</span><br></pre></td></tr></table></figure>
<p>上述代码基本实现了日前我们的需求，代码性能还需优化，比如实例点位，实例圆形，都可以进行缓存。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">//缓存</span><br><span class="line">var d=function()&#123;</span><br><span class="line">	var cache=&#123;</span><br><span class="line">		</span><br><span class="line">	&#125;;//缓存列表</span><br><span class="line">	function sum()&#123;</span><br><span class="line">		var arg=[].slice.call(arguments);</span><br><span class="line">		args=arg.join(),</span><br><span class="line">		l=arguments.length;</span><br><span class="line">		if(cache[args])&#123;</span><br><span class="line">			return cache[args];</span><br><span class="line">		&#125;</span><br><span class="line">		var n=0;</span><br><span class="line">		while(--l)&#123;</span><br><span class="line">			n+=arguments[l];</span><br><span class="line">		&#125;</span><br><span class="line">		console.log(&apos;-----------只计算第一次-------&apos;)</span><br><span class="line">		cache[args]=n;</span><br><span class="line">		return n;</span><br><span class="line">	&#125;</span><br><span class="line">	return &#123;</span><br><span class="line">		sum:sum,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;();</span><br></pre></td></tr></table></figure>
<p>利用闭包特性进行缓存数据，以更快速反馈给用户。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/3/28/1626a7a63f452ac6?w=644&amp;h=821&amp;f=png&amp;s=61322" alt=""><br>上面代码如何使用：<br>第一步确定使用哪类地图，这个值可以是后台模板输出。通过这个值加载相应的地图。<br>第二步引入刚刚实现的库<br>第三步使用咱们自己实现的库<br>HTML<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=&quot;Map&quot; style=&quot;height:500px;&quot;&gt;</span><br><span class="line">			</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure></p>
<p>js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line">//配置默认项</span><br><span class="line">Gis_Map.config = &#123;</span><br><span class="line">	maptype: 1, //0:代表百度地图，1：高德地图，2：腾讯地图</span><br><span class="line">&#125;</span><br><span class="line">var maps = null;</span><br><span class="line">//执行主函数。</span><br><span class="line">Gis_Map.init();</span><br><span class="line">maps = Gis_Map.Map(&apos;Map&apos;, &#123; enableMapClick: false, minZoom: 5, &#125;);</span><br><span class="line">//console.log(Gis_Map.pulic.centerAndZoom,&apos;Gis_Map.pulic.centerAndZoom&apos;);</span><br><span class="line">var point = Gis_Map.Point(116.404, 39.915);</span><br><span class="line">//使用返回实例 也可以实现    </span><br><span class="line">maps.centerAndZoom(point, 5);</span><br><span class="line">//是否启用缩放设置</span><br><span class="line">maps.enableScrollWheelZoom(true);</span><br><span class="line">//console.log(maps);</span><br><span class="line">/**</span><br><span class="line"> * 给地图绑定点击事件</span><br><span class="line"> * */</span><br><span class="line">maps.addEventListener(&apos;click&apos;, function(e) &#123;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line">//创建icon</span><br><span class="line">var icons = Gis_Map.Icon(&apos;js/map_js/icon.png&apos;, Gis_Map.Size(48, 53));</span><br><span class="line">//创建maker</span><br><span class="line">var maker = Gis_Map.Marker(Gis_Map.Point(112.361031, 36.391437), &#123; title: &apos;maker&apos;, icon: icons &#125;);</span><br><span class="line"></span><br><span class="line">Gis_Map.convertFrom(Gis_Map.Point(114.469026, 35.45613), function(a, b) &#123;</span><br><span class="line">	console.log(a, b);</span><br><span class="line">	if(b.info === &apos;ok&apos;) &#123;</span><br><span class="line"></span><br><span class="line">		var maker_1 = Gis_Map.Marker(Gis_Map.Point(b.locations[0].lng, b.locations[0].lat), &#123; title: &apos;maker_1&apos;, icon: icons &#125;);</span><br><span class="line">		maps.addOverlay(maker_1);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">maker.addEventListener(&apos;click&apos;, function(e) &#123;</span><br><span class="line">	var p = e.target;</span><br><span class="line">	var point = Gis_Map.Point(p.getPosition().lng, p.getPosition().lat);</span><br><span class="line"></span><br><span class="line">	var winfor = Gis_Map.InfoWindow(&apos;&lt;div class=&quot;InfoWindow&quot;&gt;InfoWindow 当前经度：&apos; + p.getPosition().lng + &apos;        当前纬度：&apos; + p.getPosition().lat + &apos;     &lt;div&gt;&apos;, &#123;</span><br><span class="line">		width: 400,</span><br><span class="line">		height: 200</span><br><span class="line">	&#125;);</span><br><span class="line"></span><br><span class="line">	Gis_Map.openInfoWindow(winfor, point);</span><br><span class="line">&#125;);</span><br><span class="line">//添加标注</span><br><span class="line">maps.addOverlay(maker);</span><br><span class="line"></span><br><span class="line">var yuan = Gis_Map.Circle(Gis_Map.Point(116.404, 39.915), 200000, &#123;</span><br><span class="line">	fillColor: &quot;blue&quot;, //填充颜色</span><br><span class="line">	strokeWeight: 1, //描边粗细</span><br><span class="line">	fillOpacity: 0.3, //填充透明度</span><br><span class="line">	strokeOpacity: 0.3 //描边透明度</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">maps.addOverlay(yuan);</span><br><span class="line"></span><br><span class="line">var p1 = [116.148568, 37.904113];</span><br><span class="line">var p2 = [116.167794, 37.934447];</span><br><span class="line">var p3 = [116.230965, 37.960437];</span><br><span class="line">var p4 = [116.277657, 37.990748];</span><br><span class="line">var p5 = [116.373788, 38.014555];</span><br><span class="line"></span><br><span class="line">var xian = Gis_Map.Polyline([p1, p2, p3, p4, p5], &#123;</span><br><span class="line">	strokeColor: &quot;#000000&quot;, //设置颜色</span><br><span class="line">	strokeWeight: 10, //宽度  </span><br><span class="line">	strokeOpacity: 1, //透明度</span><br><span class="line">	strokeStyle: &quot;solid&quot;</span><br><span class="line">&#125;);</span><br><span class="line">// console.log(xian);</span><br><span class="line">maps.addOverlay(xian);</span><br><span class="line"></span><br><span class="line">var label = Gis_Map.Label(&apos;测试数据&apos;, &#123;</span><br><span class="line">	offset: Gis_Map.Pixel(2, 5),</span><br><span class="line">	position: [112.361031, 36.391437],</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">maps.addOverlay(label);</span><br><span class="line"></span><br><span class="line">var text = new AMap.Text(&#123;</span><br><span class="line">	text: &apos;纯文本标记&apos;,</span><br><span class="line">	textAlign: &apos;center&apos;, // &apos;left&apos; &apos;right&apos;, &apos;center&apos;,</span><br><span class="line">	verticalAlign: &apos;middle&apos;, //middle 、bottom</span><br><span class="line">	draggable: true,</span><br><span class="line">	cursor: &apos;pointer&apos;,</span><br><span class="line">	angle: 10,</span><br><span class="line">	style: &#123;</span><br><span class="line">		&apos;background-color&apos;: &apos;yellow&apos;,</span><br><span class="line">		&apos;border&apos;: &apos;solid 1px #0088ff&apos;,</span><br><span class="line">		&apos;padding&apos;: &apos;10px 20px&apos;</span><br><span class="line">	&#125;,</span><br><span class="line">	position: [116.396923, 39.918203]</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">//地址搜索</span><br><span class="line">Gis_Map.LocalSearch(maps, &#123;</span><br><span class="line">	input: &apos;search&apos;,</span><br><span class="line">	output: &apos;list&apos;,</span><br><span class="line">	callback: function(e) &#123;</span><br><span class="line">		console.log(e);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">var point1 = Gis_Map.Point(116.368904, 39.923423);</span><br><span class="line">var point2 = Gis_Map.Point(116.387271, 39.922501);</span><br><span class="line">console.log(maps.getDistance(point1, point2), &apos;=====两点间的距离&apos;);</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 在地图上拉框 返回拉的框坐标位置</span><br><span class="line"> * 参数</span><br><span class="line"> *  map	Map	要显示该rectangle的地图对象</span><br><span class="line">	zIndex	Number	层叠顺序</span><br><span class="line">	默认zIndex:10</span><br><span class="line">	bounds	Bounds	矩形的范围</span><br><span class="line">	bubble	Boolean	是否将覆盖物的鼠标或touch等事件冒泡到地图上 </span><br><span class="line">	默认值：false</span><br><span class="line">	cursor	String	指定鼠标悬停时的鼠标样式，自定义cursor，IE仅支持cur/ani/ico格式，Opera不支持自定义cursor</span><br><span class="line">	strokeColor	String	线条颜色，使用16进制颜色代码赋值。默认值为#006600</span><br><span class="line">	strokeOpacity	Float	轮廓线透明度，取值范围[0,1]，0表示完全透明，1表示不透明。默认为0.9</span><br><span class="line">	strokeWeight	Number	轮廓线宽度</span><br><span class="line">	fillColor	String	矩形填充颜色,使用16进制颜色代码赋值。默认值为#006600</span><br><span class="line">	fillOpacity	Float	矩形填充透明度，取值范围[0,1]，0表示完全透明，1表示不透明。默认为0.9</span><br><span class="line">	strokeStyle	String	轮廓线样式，实线:solid，虚线:dashed</span><br><span class="line">	extData	Any	用户自定义属性，支持JavaScript API任意数据类型，如Rectangle的id等</span><br><span class="line">	strokeDasharray	Array	勾勒形状轮廓的虚线和间隙的样式，此属性在strokeStyle 为dashed 时有效， 此属性在ie9+浏览器有效 取值： </span><br><span class="line">	实线：[0,0,0] </span><br><span class="line">	虚线：[10,10] ，[10,10] 表示10 个像素的实线和10 个像素的空白（如此反复）组成的虚线</span><br><span class="line">	点画线：[10,2,10]， [10,2,10] 表示10 个像素的实线和2 个像素的空白 + 10 个像素的实线和10 个像素的空白 （如此反复）组成的虚线</span><br><span class="line"> * </span><br><span class="line"> * */</span><br><span class="line">Gis_Map.SearchInRectangle(&#123;</span><br><span class="line">	callback: function(e) &#123;</span><br><span class="line">		//矩形的 Bounds【范围】</span><br><span class="line">		console.log(&apos;SearchInRectangle=====callback&apos;, e);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>有时候改轮子也好造轮子也罢！只有你能驾驭他们那你就是成功的。通过上边此次代码编写，让自己在架构上走了一步。只有自己不断学习，不断尝试，才能实现自己的职业规划。</p>
<p>打赏通道–我觉得不会有打赏。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/11/28/167592f13078d6a8?w=800&amp;h=600&amp;f=jpeg&amp;s=184358" alt=""></p>
<p><img src="https://user-gold-cdn.xitu.io/2018/4/14/162c4b13a41e4a3a?w=323&amp;h=311&amp;f=png&amp;s=83969" alt=""></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/02/06/bigDate/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小小坤">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/log.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小小坤">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/06/bigDate/" itemprop="url">渲染大量数据我是这样操作的</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-02-06T13:06:00+08:00">
                2018-02-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>事情的由来是这样紫的，目前我负责公司内部的核心业务Gis天眼系统开发，遇到一个问题就是：后端返回几千条数据导致浏览器渲染失败，浏览器几乎是停滞状态。后来没有想到合适的解决方案，临时渲染少量数据解决了。我记得清清楚楚，我已经看过关于这样的问题怎么解决，可惜我没有使用，原因是<strong>学而不思，看而不用</strong>。后来由于家里有些事情，我请假回家休假休息了一段时间。回来之后开了一次会议，说我同事 实现了一个上述问题，用到了js线程。然后我就针对此问题开始了二次思考。就有了本文。</p>
<h2 id="JS线程"><a href="#JS线程" class="headerlink" title="JS线程"></a>JS线程</h2><p>浏览器内分js线程、GUI渲染线程、事件触发线程、等。大家都知道JS是单线程，但是问题来了，单线程如何实现异步，比如说我们经常使用的Ajax是怎么实现的呢？当你真正了解JS的Event Loop你就会明白！哦：原来如此。这里我就对线程进行抛砖引玉，如果想深入学习可以看一下这篇文章：<a href="https://segmentfault.com/a/1190000012806637" target="_blank" rel="noopener">https://segmentfault.com/a/1190000012806637</a></p>
<h2 id="如何渲染大量数据"><a href="#如何渲染大量数据" class="headerlink" title="如何渲染大量数据"></a>如何渲染大量数据</h2><p>渲染大量数据肯定会涉及到GUI渲染线程与js线程。如下简单的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line">  dom 节点</span><br><span class="line">--&gt;</span><br><span class="line">&lt;div id=&quot;app&quot;&gt;</span><br><span class="line">			</span><br><span class="line">&lt;/div&gt;	</span><br><span class="line"></span><br><span class="line">//js代码			</span><br><span class="line">var app=document.getElementById(&quot;app&quot;);			</span><br><span class="line">for(var i=0;i&lt;100;i++)&#123;</span><br><span class="line">	var span=document.createElement(&quot;span&quot;);</span><br><span class="line">	span.innerHTML = i;</span><br><span class="line">	app.appendChild(span);//例子才会这样写的</span><br><span class="line">	/**</span><br><span class="line">	*工作中会 这样写，拼接字符串，for循环结束后一次性appendChild</span><br><span class="line">	*/</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>从上面代码可以分析、每次for循环使用dom进行渲染。浏览器是怎么渲染的呢？JS线程是单线程，它如果执行js线程，GUI渲染线程肯定会等候，这样一来渲染大量数据就会造成页面卡顿，甚至停滞、奔溃。页面显示效果就是一下子这些dom节点全部渲染出来。知道了这一点，我们就可以想办法解决它（渲染大量数据）。</p>
<h2 id="初探代码执行方式"><a href="#初探代码执行方式" class="headerlink" title="初探代码执行方式"></a>初探代码执行方式</h2><p>如下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">console.log(1);</span><br><span class="line">setTimeout(function()&#123;</span><br><span class="line">	console.log(2);</span><br><span class="line">&#125;,100);</span><br><span class="line">console.log(3);</span><br></pre></td></tr></table></figure>
<p>大家肯定会说这个很简单，输出1  3   2。我想说的是大家看JS的Event Loop了吗？看了肯定知道其原理。</p>
<ol>
<li>首先判断JS是同步还是异步,同步就进入主进程,异步就进入event table</li>
<li>异步任务在event table中注册函数,当满足触发条件后,被推入event queue</li>
<li>同步任务进入主线程后一直执行,直到主线程空闲时,才会去event queue中查看是否有可执行的异步任务,如果有就推入主进程中。<h2 id="第一版本"><a href="#第一版本" class="headerlink" title="第一版本"></a>第一版本</h2></li>
</ol>
<p><img src="https://user-gold-cdn.xitu.io/2018/2/4/161618939ab00638?w=1347&amp;h=618&amp;f=png&amp;s=203850" alt=""><br>我使用了递归调用实现如下代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">var app=document.getElementById(&quot;app&quot;);</span><br><span class="line"></span><br><span class="line">var j=1;</span><br><span class="line">/**</span><br><span class="line"> * 渲染方式</span><br><span class="line"> * </span><br><span class="line"> * @number &#123;number&#125; 数量</span><br><span class="line"> * */</span><br><span class="line">function showDom(number)&#123;</span><br><span class="line">	console.log(&apos;渲染&apos;+(j++)+&quot;次&quot;);</span><br><span class="line">	for(var i=0;i&lt;number;i++)&#123;</span><br><span class="line">		var span=document.createElement(&quot;span&quot;);</span><br><span class="line">		span.innerHTML = i;</span><br><span class="line">		app.appendChild(span);//例子才会这样写的</span><br><span class="line">		/**</span><br><span class="line">    	*工作中会 这样写，拼接字符串，for循环结束后一次性appendChild</span><br><span class="line">    	*/</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">/**</span><br><span class="line"> * 渲染大数据量的dom节点</span><br><span class="line"> * </span><br><span class="line"> * @count &#123;number&#125; 总数量</span><br><span class="line"> * </span><br><span class="line"> * */</span><br><span class="line">function init(count)&#123;</span><br><span class="line">	if(typeof count!==&quot;number&quot;) &#123;</span><br><span class="line">		console.warn(count+&quot;类型不是：Number&quot;);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	if(count&gt;500)&#123;</span><br><span class="line">		setTimeout(function()&#123;</span><br><span class="line">			showDom(500);</span><br><span class="line">			init(count-500);</span><br><span class="line">		&#125;,200);</span><br><span class="line">	&#125;else&#123;</span><br><span class="line">		showDom(count);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">init(4000);</span><br></pre></td></tr></table></figure></p>
<p>可以看出利用上述方式可以简单轻松实现渲染大量数据，给用户的感觉是，当前数据很多，我需要一步一步渲染。比之前一下子渲染几千条数据导致GUI渲染引擎卡顿、甚至停滞强多啦。</p>
<h2 id="第二版本"><a href="#第二版本" class="headerlink" title="第二版本"></a>第二版本</h2><p>接下来我又参考书籍使用了下面的代码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 分时函数</span><br><span class="line"> * @ary &#123;Arry&#125; 数据</span><br><span class="line"> * @callback &#123;Function&#125; 回掉函数，一个参数，当前数据项</span><br><span class="line"> * @count &#123;Number&#125; 数量</span><br><span class="line"> * </span><br><span class="line"> * */</span><br><span class="line">function timeChunk(ary,callback,count)&#123;</span><br><span class="line">	var objTs=Object.prototype.toString,//检测类型</span><br><span class="line">	t;//定时器</span><br><span class="line">	if(objTs.call(ary)!==&quot;[object Array]&quot;)&#123;</span><br><span class="line">		return console.warn(ary+&quot;---》应该是Arry类型&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">	if(objTs.call(callback)!==&quot;[object Function]&quot;)&#123;</span><br><span class="line">		return console.warn(callback+&quot;---》应该是回掉函数&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">	if(objTs.call(count)!==&quot;[object Number]&quot;)&#123;</span><br><span class="line">		return console.warn(count+&quot;---》应该是Number类型&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">	//开始执行函数    </span><br><span class="line">	function start()&#123;</span><br><span class="line">		for(var i=0;i&lt;Math.min(count||1,ary.length);i++)&#123;</span><br><span class="line">			callback(ary.shift());</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	return function()&#123;</span><br><span class="line">		t=setInterval(function()&#123;</span><br><span class="line">			if(ary.length===0)&#123;</span><br><span class="line">			 </span><br><span class="line">				return clearInterval(t);</span><br><span class="line">			&#125;</span><br><span class="line">			start();</span><br><span class="line">		&#125;,200);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">//后端返回数据</span><br><span class="line"></span><br><span class="line">var ayy=[];</span><br><span class="line">for (var a=0;a&lt;50000;a++) &#123;</span><br><span class="line">	ayy.push(a);</span><br><span class="line">&#125;</span><br><span class="line">//开始使用 分时函数</span><br><span class="line">var init=timeChunk(ayy,function(i)&#123;</span><br><span class="line">	var span=document.createElement(&quot;span&quot;);</span><br><span class="line">	span.innerHTML = i;</span><br><span class="line">	app.appendChild(span);</span><br><span class="line">&#125;,500);</span><br><span class="line">//开始渲染大数据</span><br><span class="line">init();</span><br></pre></td></tr></table></figure>
<h2 id="参考demo"><a href="#参考demo" class="headerlink" title="参考demo"></a>参考demo</h2><p>dome1 <a href="http://sandbox.runjs.cn/show/154bzaip" target="_blank" rel="noopener">http://sandbox.runjs.cn/show/154bzaip</a></p>
<p>dome2 <a href="http://sandbox.runjs.cn/show/hne29nn0" target="_blank" rel="noopener">http://sandbox.runjs.cn/show/hne29nn0</a></p>
<h2 id="2018-02-06更新"><a href="#2018-02-06更新" class="headerlink" title="2018-02-06更新"></a>2018-02-06更新</h2><ol>
<li><p>document.createDocumentFragment是最完美的选择。</p>
</li>
<li><p>for循环内appendChild到底会不会引起浏览器渲染—-我的回答：不会。<br>因为js线程一直占用，GUI渲染线程等待，只有js线程空闲，GUI渲染线程才会渲染。</p>
</li>
<li><p>setInterval不是最优选择，应该使用setTimeout实现setInterval</p>
</li>
<li><p>什么时候会出现内存泄漏？</p>
</li>
</ol>
<h3 id="这是两种不同的渲染方式"><a href="#这是两种不同的渲染方式" class="headerlink" title="这是两种不同的渲染方式"></a>这是两种不同的渲染方式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">var app=document.getElementById(&quot;app&quot;);</span><br><span class="line">var fragment=document.createDocumentFragment();</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 渲染方式1</span><br><span class="line"> * 使用createDocumentFragment</span><br><span class="line"> * </span><br><span class="line"> * @number &#123;number&#125; 数量</span><br><span class="line"> * */</span><br><span class="line">function showDom(number)&#123;</span><br><span class="line"></span><br><span class="line">	for(var i=0;i&lt;number;i++)&#123;</span><br><span class="line">		var span=document.createElement(&quot;span&quot;);</span><br><span class="line">		span.innerHTML = i;</span><br><span class="line">		//app.appendChild(span);</span><br><span class="line">		fragment.appendChild(span);</span><br><span class="line">	&#125;</span><br><span class="line">	app.appendChild(fragment);</span><br><span class="line">&#125;</span><br><span class="line">showDom(10000);</span><br><span class="line">/**</span><br><span class="line"> * 渲染方式2</span><br><span class="line"> * 使用appendChild</span><br><span class="line"> * </span><br><span class="line"> * @number &#123;number&#125; 数量</span><br><span class="line"> * */</span><br><span class="line">function showDom1(number)&#123;</span><br><span class="line"></span><br><span class="line">	for(var i=0;i&lt;number;i++)&#123;</span><br><span class="line">		var span=document.createElement(&quot;span&quot;);</span><br><span class="line">		span.innerHTML = i;</span><br><span class="line">		app.appendChild(span);</span><br><span class="line">		//fragment.appendChild(span);</span><br><span class="line">	&#125;</span><br><span class="line">	//app.appendChild(fragment);</span><br><span class="line">&#125;</span><br><span class="line">//showDom1(10000); </span><br><span class="line">//可以使用Chrome浏览器 TimeLine查看js线程与渲染线程占用时间。</span><br></pre></td></tr></table></figure>
<p>这是直接使用appendChild方法<br><img src="https://user-gold-cdn.xitu.io/2018/2/6/1616b6d785a975c4?w=564&amp;h=348&amp;f=png&amp;s=17074" alt=""><br>这是结果<br><img src="https://user-gold-cdn.xitu.io/2018/2/6/1616b6dc9bae345e?w=1042&amp;h=571&amp;f=png&amp;s=161543" alt=""><br>这是使用createDocumentFragment方法</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/2/6/1616b6ee19d38ff9?w=480&amp;h=379&amp;f=png&amp;s=17825" alt=""><br>这是结果</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/2/6/1616b6f1f38646ac?w=952&amp;h=601&amp;f=png&amp;s=64735" alt=""></p>
<h2 id="谢谢大家的宝贵意见"><a href="#谢谢大家的宝贵意见" class="headerlink" title="谢谢大家的宝贵意见"></a>谢谢大家的宝贵意见</h2><p>谢谢大家能够提出这些宝贵的意见，希望大家能够理性评论、互动。每个人掌握的知识点都是有限的，只有大家一起讨论才会发现问题，解决问题。希望大家能够理解。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>要在学习中思考，在项目中实战。总有一天你会变得更加厉害！</p>
<p>打赏通道–我觉得不会有打赏。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/11/28/167592f13078d6a8?w=800&amp;h=600&amp;f=jpeg&amp;s=184358" alt=""></p>
<p><img src="https://user-gold-cdn.xitu.io/2018/4/14/162c4b13a41e4a3a?w=323&amp;h=311&amp;f=png&amp;s=83969" alt=""></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/06/es6toes5/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小小坤">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/log.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小小坤">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/06/es6toes5/" itemprop="url">ES6函数比对ES5函数</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-01-06T13:06:00+08:00">
                2018-01-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>这里只做简单的ES6函数与ES5函数对比，把ES6函数中新增的方法或者用法介绍一下。方便大家学习、记忆。随着社会发展，浏览器肯定会在不久全部支持ES6语法，因为现在的IE8用户都很少了,做web前端将不再受此束缚！</p>
<h2 id="函数参数的默认值"><a href="#函数参数的默认值" class="headerlink" title="函数参数的默认值"></a>函数参数的默认值</h2><p>其他语言已经支持函数参数默认值，咱们Js也不会落后的。例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">//es6写法</span><br><span class="line">/**</span><br><span class="line"> * @a &#123;number&#125; 默认值10</span><br><span class="line"> * @b &#123;number&#125; 默认值20</span><br><span class="line"> * */</span><br><span class="line">function fn(a=10,b=20)&#123;</span><br><span class="line">	console.log(a,b);</span><br><span class="line">&#125;</span><br><span class="line">fn();//没有传递参数</span><br><span class="line">fn(1,3);//传递了参数</span><br><span class="line"></span><br><span class="line">//es5写法</span><br><span class="line">/**</span><br><span class="line"> * @a &#123;number&#125; 默认值10</span><br><span class="line"> * @b &#123;number&#125; 默认值20</span><br><span class="line"> * */</span><br><span class="line">function fn(a, b) &#123;</span><br><span class="line">  a = a || 10;//设置默认值</span><br><span class="line">  b = b || 20;//设置默认值</span><br><span class="line">  console.log(a, b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ol>
<li><p>先说说es5写法这种写法，如果a传递的是false或者（求值为false的值） 则a会使用默认值10，这样代码就没有按照我们期望的那样去执行。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//修改es5写法让它实现类似于es6：</span><br><span class="line">//es5写法</span><br><span class="line">/**</span><br><span class="line"> * @a &#123;number&#125; 默认值10</span><br><span class="line"> * @b &#123;number&#125; 默认值20</span><br><span class="line"> * */</span><br><span class="line">function fn(a, b) &#123;</span><br><span class="line">   a = a!==undefined?a:10;//设置默认值</span><br><span class="line">   b = b!==undefined?b:20;//设置默认值</span><br><span class="line">  console.log(a, b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>es6写法如果传入undefined，将触发该参数等于默认值，其他值不会触发默认值。</p>
</li>
<li><p>es6设置默认参数值，在函数体内不允许再次使用let或者const声明。例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * es6写法</span><br><span class="line"> * @a &#123;number&#125; 默认值10</span><br><span class="line"> * @b &#123;number&#125; 默认值20</span><br><span class="line"> * */</span><br><span class="line">function fn(a=10,b=20)&#123;</span><br><span class="line">    let a=100;//会报错哦！</span><br><span class="line">    const b=20;//会报错哦！</span><br><span class="line">	console.log(a,b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置参数默认值会产生单独的作用域。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * es6写法</span><br><span class="line"> * 默认值会产生单独的作用域，作用域的代码也是按照先左后右顺序执行。</span><br><span class="line"> * @a &#123;number&#125; 默认值10</span><br><span class="line"> * @b &#123;number&#125; 默认值10+20</span><br><span class="line"> * */</span><br><span class="line">function fn(a=10,b=a+20)&#123;//如果这里是(a=b+20,b=10)调用时a没有传递参数此时会报错！</span><br><span class="line">	console.log(a,b);</span><br><span class="line">&#125;</span><br><span class="line">//复杂的例子</span><br><span class="line">/*-----------一条华丽的分割线-------------*/</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * ----------默认值会产生单独的作用域-----------</span><br><span class="line"> * 调用函数fn 时，未传递参数，【默认参数单独作用域】a值为undefined，b值为undefined。</span><br><span class="line"> * 当执行b()函数时，则查找到a值为undefined,不在查找全局a。</span><br><span class="line"> * 因此为结果为：a的值为： undefined</span><br><span class="line"> * */</span><br><span class="line">var a=&apos;全局变量&apos;;</span><br><span class="line">function fn(a,b=function()&#123; console.log(&apos;a的值为：&apos;,a);&#125;)&#123;</span><br><span class="line">	b();</span><br><span class="line">&#125;</span><br><span class="line">fn();//a的值为： undefined</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * ----------默认值会产生单独的作用域-----------</span><br><span class="line"> * 调用函数fn 时，未传递参数，b值为undefined。</span><br><span class="line"> * 当执行b()函数时，则寻找a值发现全局a。</span><br><span class="line"> * 因此为结果为：a的值为： 全局变量</span><br><span class="line"> * */</span><br><span class="line">var a=&apos;全局变量&apos;;</span><br><span class="line">function fn(b=function()&#123; console.log(&apos;a的值为：&apos;,a);&#125;)&#123;</span><br><span class="line">	b();</span><br><span class="line">&#125;</span><br><span class="line">fn();//a的值为： 全局变量</span><br><span class="line"></span><br><span class="line">**</span><br><span class="line"> * 现在再来理解一下这个。看看你能答对吗？</span><br><span class="line"> * */</span><br><span class="line">var a = &apos;小小坤&apos;;</span><br><span class="line">function fn(a, y = function() &#123;a = &apos;小小坤1&apos;;&#125;) &#123;</span><br><span class="line">   var a = &apos;小小坤2&apos;;</span><br><span class="line">   y();</span><br><span class="line">  console.log(a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn() // 答案是？</span><br><span class="line">console.log(a); // 答案是？</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用参数默认值时，函数不能有同名参数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function fn(a,a,b)&#123;</span><br><span class="line">	console.log(a,b);//不报错</span><br><span class="line">&#125;</span><br><span class="line">function fn(a,a,b=1)&#123;</span><br><span class="line">	console.log(a,b);//报错</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="rest-参数"><a href="#rest-参数" class="headerlink" title="rest 参数"></a>rest 参数</h2><p>ES6 引入 rest 参数（形式为…变量名），用于获取函数的多余参数，这样就不需要使用arguments对象了。rest 参数搭配的变量是一个数组，该变量将多余的参数放入数组中。例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">//es6写法</span><br><span class="line">/**</span><br><span class="line"> * @b &#123;arry&#125; 参数列表</span><br><span class="line"> *  </span><br><span class="line"> * */</span><br><span class="line">function fn(...b)&#123;</span><br><span class="line">	b.push(&apos;小小坤&apos;);</span><br><span class="line">	console.log(b);</span><br><span class="line">&#125;</span><br><span class="line">fn(1,&apos;20&apos;);//[1, &quot;20&quot;, &quot;小小坤&quot;]</span><br><span class="line"></span><br><span class="line">//es5写法</span><br><span class="line">/**</span><br><span class="line"> * @a &#123;number&#125; 参数a</span><br><span class="line"> * @b &#123;number&#125; 参数b</span><br><span class="line"> * */</span><br><span class="line">function fn(a, b) &#123;</span><br><span class="line">   var arg=[].slice.call(arguments);</span><br><span class="line">   arg.push(&apos;小小坤&apos;);</span><br><span class="line">   console.log(arg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>需要注意的是：</p>
<ol>
<li><p>函数length 属性不包含rest 参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(function(a) &#123;&#125;).length  // 1</span><br><span class="line">(function(...a) &#123;&#125;).length  // 0</span><br><span class="line">(function(a, ...b) &#123;&#125;).length  // 1</span><br></pre></td></tr></table></figure>
</li>
<li><p>rest 参数不可以这样使用,只能是最后一个参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function fn (a,...b,d)&#123;</span><br><span class="line">   //会报错！	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="箭头函数"><a href="#箭头函数" class="headerlink" title="箭头函数"></a>箭头函数</h2><h4 id="使用时注意事项："><a href="#使用时注意事项：" class="headerlink" title="使用时注意事项："></a>使用时注意事项：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1）函数体内的this对象，就是定义时所在的对象，而不是使用时所在的对象。</span><br><span class="line">2）不可以当作构造函数，也就是说，不可以使用new命令，否则会抛出一个错误。</span><br><span class="line">3）不可以使用arguments对象，该对象在函数体内不存在。如果要用，可以用 rest 参数代替。</span><br><span class="line">4）不可以使用yield命令，因此箭头函数不能用作 Generator 函数。</span><br></pre></td></tr></table></figure>
<h5 id="简单例子"><a href="#简单例子" class="headerlink" title="简单例子"></a>简单例子</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/*-----------例子--1------*/</span><br><span class="line">//es6写法</span><br><span class="line">var fn = n =&gt; n;</span><br><span class="line"></span><br><span class="line">//等同于es5 写法</span><br><span class="line">var fn = function(n) &#123;</span><br><span class="line">  return n;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/*-----------例子--2------*/</span><br><span class="line">//es6写法</span><br><span class="line">var fn = () =&gt; 5;</span><br><span class="line">// 等同于 es5 写法</span><br><span class="line">var fn = function () &#123; return 5 &#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/*-----------例子--3------*/</span><br><span class="line">//es6写法</span><br><span class="line">var sum = (n1, n2) =&gt; n1 + n2;</span><br><span class="line">// 等同于es5 写法</span><br><span class="line">var sum = function(n1, n2) &#123;</span><br><span class="line">  return n1 + n2;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>如果箭头函数的代码块部分多于一条语句，就要使用大括号将它们括起来，并且使用return语句返回。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">/*-----------例子--4------*/</span><br><span class="line">//es6写法</span><br><span class="line">var sum = (n1, n2) =&gt; &#123; return n1+n2; &#125;</span><br><span class="line"></span><br><span class="line">//由于大括号被解释为代码块，所以如果箭头函数直接返回一个对象，必须在对象外面加上括号，否则会报错。</span><br><span class="line">// 报错</span><br><span class="line">let fn = id =&gt; &#123; id: id, age: 18 &#125;;</span><br><span class="line"></span><br><span class="line">// 不报错</span><br><span class="line">let fn = id =&gt; (&#123; id: id, age: 18  &#125;);</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">/*-----------例子--5------*/</span><br><span class="line"></span><br><span class="line">function fn() &#123;</span><br><span class="line">  setTimeout(() =&gt; &#123;</span><br><span class="line">    console.log(&apos;id:&apos;, this.id);</span><br><span class="line">  &#125;, 100);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var id = 21;</span><br><span class="line"></span><br><span class="line">fn.call(&#123; id: 42 &#125;);</span><br><span class="line">// id: 42</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//ES5代码需要这样写</span><br><span class="line">function fn() &#123;</span><br><span class="line">  var _this=this;//存储this</span><br><span class="line">  setTimeout(function() &#123;</span><br><span class="line">    console.log(&apos;id:&apos;, _this.id);</span><br><span class="line">  &#125;, 100);</span><br><span class="line">&#125;</span><br><span class="line">var id = 21;</span><br><span class="line">fn.call(&#123; id: 42 &#125;);</span><br><span class="line">/**</span><br><span class="line"> *  上面代码中，setTimeout的参数是一个箭头函数，这个箭头函数的定义生效是在fn函数生成时，</span><br><span class="line"> *  而它的真正执行要等到 100 毫秒后。如果是普通函数，执行时this应该指向全局对象window，</span><br><span class="line"> *  这时应该输出21。但是，箭头函数导致this总是指向函数定义生效时所在的对象（本例是&#123;id: 42&#125;），</span><br><span class="line"> *  所以输出的是42。</span><br><span class="line"> *  箭头函数可以让setTimeout里面的this，绑定定义时所在的作用域，而不是指向运行时所在的作用域。</span><br><span class="line"> * </span><br><span class="line"> *  另外，由于箭头函数没有自己的this，所以当然也就不能用call()、apply()、bind()这些方法去改变this的指向。</span><br><span class="line"> * */</span><br></pre></td></tr></table></figure>
<ol>
<li><p>this指向</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//this指向lib</span><br><span class="line">var lib=&#123;</span><br><span class="line">	option:&#123;</span><br><span class="line">		name:&apos;小小坤&apos;</span><br><span class="line">	&#125;,</span><br><span class="line">	init()&#123;</span><br><span class="line">		this.click();</span><br><span class="line">	&#125;,</span><br><span class="line">	click()&#123;</span><br><span class="line">		setTimeout(()=&gt;&#123;</span><br><span class="line">			console.log(this.option.name);</span><br><span class="line">		&#125;,2000);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">lib.init();//小小坤</span><br></pre></td></tr></table></figure>
</li>
<li><p>不能使用构造函数</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var des=(n)=&gt;&#123;this.n=n&#125;;</span><br><span class="line">new des(1);//des is not a constructor</span><br><span class="line">//因为没有this</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>没有arguments属性</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var des=(n)=&gt;&#123;console.log(arguments)&#125;;</span><br><span class="line">des();//arguments is not defined</span><br><span class="line">//可以这样使用</span><br><span class="line">var des=(...n)=&gt;&#123;console.log(n)&#125;;</span><br><span class="line">des(1,2,3,4,5);//[1,2,3,4,5]</span><br></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>经过以上对比可以看出ES6写的代码会越来越少，代码质量也逐渐提升。比如默认参数，箭头函数，还有rest 参数，使用起来爽爆棚！没有在开发环境使用的ES6的同学我们也要抓紧学习啦！</p>
<p>打赏通道–我觉得不会有打赏。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/11/28/167592f13078d6a8?w=800&amp;h=600&amp;f=jpeg&amp;s=184358" alt=""></p>
<p><img src="https://user-gold-cdn.xitu.io/2018/4/14/162c4b13a41e4a3a?w=323&amp;h=311&amp;f=png&amp;s=83969" alt=""></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/log.jpg" alt="小小坤">
            
              <p class="site-author-name" itemprop="name">小小坤</p>
              <p class="site-description motion-element" itemprop="description">前端技术文章，JavaScript设计模式，专注前端10年。</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">17</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">小小坤</span>
  &nbsp;&nbsp; &nbsp;&nbsp;<a href="http://www.miitbeian.gov.cn" target="_blank">豫ICP备16005267号</a>
  
</div>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
